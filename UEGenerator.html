<html>
<head>
<title>Ultimate Equipment treasure generator</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- 
	This HTML file is an implementation of the treasure generator in the Paizo's Ultimate Equipment, for the 
	Pathfinder gaming sysytem. UE is copyright Paizo Publishing, and the data therin is used without permission.
	
	The code is copyright (c) 2014 Paul Murray, pmurray@bigpond.com, twitter PaulMurrayCbr, paulmurray.wordpress.com.
	
	License is Creative Commons "non-commercial with attribution"

	(like, yeah right: I will totally sic my lawyers onto you if you diss my rights)
	
 -->

<style type="text/css">
.money {
	border: thin solid gray;
	text-align: right;
	padding-left: .5em;
	padding-right: .5em;
	font-family: monospace;
}

.centercell {
	border: thin solid gray;
	text-align: center;
	padding-left: .5em;
	padding-right: .5em;
}

.cell {
	border: thin solid gray;
	text-align: left;
	padding-left: .5em;
	padding-right: .5em;
}

.cellNoB {
	text-align: left;
	padding-left: .5em;
	padding-right: .5em;
}
</style>

</head>
<script type="text/javascript">
	function initAll() {
			mainTreasureBlock = new OverallTreasureBlock(document
					.getElementById("MAIN-TREASURE"), 0);
			recalcTotalTreasureBudget();
	}

	// a global.

	var totalTreasureBudget = 0;

	var t7_1_slow = [ 0, 170, 350, 550, 750, 1000, 1350, 1750, 2200, 2850,
			3650, 4650, 6000, 7750, 10000, 13000, 16500, 22000, 28000, 35000,
			44000 ];
	var t7_1_medium = [ 0, 260, 550, 800, 1150, 1550, 2000, 3600, 3350, 4250,
			5450, 7000, 9000, 11600, 15000, 19500, 25000, 32000, 41000, 53000,
			67000 ];
	var t7_1_fast = [ 0, 4000, 8000, 1200, 1700, 2300, 3000, 3900, 5000, 6400,
			8200, 10500, 13500, 17500, 22000, 29000, 38000, 48000, 62000,
			79000, 100000 ];

	var mainTreasureBlock;
	
	var npcCount = 0;
	var npcList = new Array();

	function recalcTotalTreasureBudget() {
		var apl = parseInt(document.getElementById("APL").value);
		var track;
		if (document.getElementById("AdvancementRate").value == 'slow') {
			track = t7_1_slow;
		} else if (document.getElementById("AdvancementRate").value == 'fast') {
			track = t7_1_fast;
		} else {
			track = t7_1_medium;
		}

		totalTreasureBudget = track[apl];

		if (document.getElementById("APLMultiplier").value == 'incidental') {
			totalTreasureBudget /= 2;
		} else if (document.getElementById("APLMultiplier").value == 'double') {
			totalTreasureBudget *= 2;
		} else if (document.getElementById("APLMultiplier").value == 'triple') {
			totalTreasureBudget *= 3;
		}

		document.getElementById("totaltreasurebudget").innerHTML = totalTreasureBudget;
		
		var mainBudget = totalTreasureBudget;
		
		for(var i = 0; i<npcCount; i++) {
			mainBudget -= npcList[i].budget;
		}

		mainTreasureBlock.setBudget(mainBudget);
	}
	
	function repopulateSummary() {
	}
	
	function addNPCBlock() {
		var div = document.createElement('div');
		npcList[npcCount] = new OverallTreasureBlock(div, 100, true, npcCount);
		npcCount ++;
		document.getElementById('NPC-TREASURES').appendChild(div);
		recalcTotalTreasureBudget();
	}
	
	var T7_2 = [0,260,390,780,1650,2400,3450,4650,6000,7800,10050,12750,16350,21000,27000,34800,45000,58500,75000,96000,123000,159000];
	
	function OverallTreasureBlock(div, budget, isNPCBlock, npcIndex) {
		this.div = div;
		this.isNPCBlock = isNPCBlock;
		this.npcIndex = npcIndex;
		div.controller = this;

		this.treasures = new Array();
		this.treasuresCount = 0;
		
		var e;
		var ee;
		var eee;

		div.appendChild(document.createElement("hr"));

		if(isNPCBlock) {
			e = document.createElement("span")
			e.appendChild(document.createTextNode("NPC Level: "));
			ee = document.createElement("select");
			for(var i = 1; i<=21;i++) {
				eee = document.createElement("option");
				eee.text = i;
				eee.value = i;
				ee.appendChild(eee);
			}
			e.appendChild(ee);
			ee.onchange = function() {
				controller(this).setBudget(T7_2[parseInt(ee.value)]);
				recalcTotalTreasureBudget();
			};
			
			div.appendChild(e);
			budget = T7_2[1];
		}
		
		
		e = document.createElement("span")
		e.appendChild(document.createTextNode("Budget: "))
		this.budgetSpan = document.createElement("span");
		e.appendChild(this.budgetSpan);
		e.appendChild(document.createTextNode(", Consumed: "))
		this.budgetConsumedSpan = document.createElement("span");
		e.appendChild(this.budgetConsumedSpan);

		div.appendChild(e);

		var treasureType = document.createElement("div");
		div.appendChild(treasureType);
		
		this.chooseTypeArea = document.createElement("div");
		div.appendChild(this.chooseTypeArea);
		this.treasureTypeSelector = new TreasureTypeSelector(this, this.chooseTypeArea);
		
		e = document.createElement("button");
		e.innerHTML = "add one treasure";
		e.onclick = function() {
			controller(this).addOne();
		};
		div.appendChild(e);

		e = document.createElement("button");
		e.innerHTML = "reroll all";
		e.onclick = function() {
			controller(this).reroll();
		};
		div.appendChild(e);

		if(isNPCBlock) {
			e = document.createElement("button");
			e.innerHTML = "delete NPC";
			e.onclick = function() {
					controller(this).delete();
			};
			div.appendChild(e);
		}

		this.treasuresArea = document.createElement("div");
		div.appendChild(this.treasuresArea);

		this.setBudget(budget);
	}

	OverallTreasureBlock.prototype.toString = function() {
		return "OverallTreasureBlock " + this.npcIndex;
	}
	
	OverallTreasureBlock.prototype.reroll = function() {
		while(this.treasuresCount > 0) {
			this.treasures[0].delete();
		}
		
		while(this.budgetConsumed < this.budget) {
			if(!this.addOne()) {
				break;
			}
		}
		
		this.treasuresArea.appendChild(document.createTextNode(new Date()));
		this.calculateBudgetConsumed();
		repopulateSummary();
	}

	OverallTreasureBlock.prototype.addOne = function() {
		var d = document.createElement('div');
		this.treasuresArea.appendChild(d);
		this.treasures[this.treasuresCount] = new TreasureBlock(d, this, this.treasuresCount);
		this.treasuresCount++;
		this.treasures[this.treasuresCount-1].reroll();
		return true;
	}

	OverallTreasureBlock.prototype.calculateBudgetConsumed = function() {
		this.budgetConsumed = 0;
		
		for(var i =0; i<this.treasuresCount; i++) {
			this.budgetConsumed += this.treasures[i].getValue();
		}
		
		this.budgetConsumedSpan.innerHTML = this.budgetConsumed;
		
		// if we are recalculating the budget consumed, then something has changed.
		repopulateSummary();
	}

	OverallTreasureBlock.prototype.delete = function() {
		for(var i = this.npcIndex; i<npcCount-1; i++) {
			npcList[i] = npcList[i+1];
			npcList[i].npcIndex = i;
		}
		
		var tt = document.getElementById('NPC-TREASURES');
		while(tt.childNodes.length != 0) {
			tt.removeChild(tt.firstChild);
		}
		npcCount --;
		
		for(var i = 0; i<npcCount; i++) {
			tt.appendChild(npcList[i].div);
		}
		
		repopulateSummary(); // redundant, because recalc does this anyway.
		
		recalcTotalTreasureBudget();
	}
	
	OverallTreasureBlock.prototype.setBudget = function(budget) {
		this.budget = budget;
		this.budgetSpan.innerHTML = budget;
		this.reroll();
	}
	
	var radioButtonSeq = 0;
	
	var treasureTypeLabels = {
			'A':'Coins',
			'B':'Coins/Gems',
			'C':'Art',
			'D':'Coins/Small objects',
			'E':'Armour and weapons',
			'F':'Combat gear',
			'G':'Spellcaster gear',
			'H':'Lair treasure',
			'I':'Hoard'
	};
	
	
	function TreasureTypeSelector(overallBlock, div) {
		this.overallBlock = overallBlock;
		this.div = div;
		div.controller = this;
		var dd;
		
		dd = document.createElement('div');
		div.appendChild(dd);
		dd.style.margin = ".5em 0 .5em 0";
		
		function creaturetype(name, treasure, extra, extratreasure) {
			var lbl = document.createElement('span');
			lbl.appendChild(document.createTextNode(name))
			
			if(extra) {
				var lbl2 = document.createElement('span');
				lbl2.appendChild(document.createTextNode(" (" + extra + ")"))
				lbl.appendChild(lbl2);
				lbl2.onclick = function(event) { 
					controller(this).selectTreasureType(treasure + extratreasure); 
					event.cancelBubble = true;
				}
			}
			lbl.style.border = 'thin solid darkGray';
			lbl.style.margin = '1px';
			lbl.style.padding = '1px';
			lbl.style.cursor = 'pointer';
			lbl.onclick = function(event) { 
				controller(this).selectTreasureType(treasure); 
			}
			dd.appendChild(lbl);
		}
		
		creaturetype('Aberration', 'ABE', 'cunning', 'FHG');
		creaturetype('Animal', 'ABDE');
		creaturetype('Construct', 'EF', 'guarding loot', 'BCH');
		creaturetype('Dragon', 'ABCHI');
		creaturetype('Fey', 'BCDG');
		creaturetype('Humanoid', 'ABDEFG', 'entire community', 'H');
		creaturetype('Magical beast', 'ABDE');
		creaturetype('Monstrous humanoid', 'ABCDEH');
		creaturetype('Ooze', 'ABD');
		creaturetype('Outsider', '');
		creaturetype('Plant', 'ABDE');
		creaturetype('Undead', 'ABDE', 'intelligent', 'FG');
		creaturetype('Vermin', 'ABD');
		
		dd = document.createElement('div');
		dd.style.margin = ".5em 0 .5em 0";
		div.appendChild(dd);

		this.checkboxes = new Object();
		var thischeckboxes = this.checkboxes;
		
		function foo(type, label) {
			var lbl = document.createElement('span');
			var checkbox = document.createElement('input');
			checkbox.type = "checkbox";
			lbl.appendChild(checkbox);
			lbl.appendChild(document.createTextNode(type + " - " + label));
			lbl.style.border = 'thin solid darkGray';
			lbl.style.margin = '1px';
			lbl.style.padding = '1px';
			lbl.style.cursor = 'pointer';
			lbl.mycheckbox = checkbox;
			
			thischeckboxes[type] = checkbox;
			
			lbl.onclick = function() {
				this.mycheckbox.checked = !this.mycheckbox.checked;
				return true;
			}
			
			dd.appendChild(lbl);
			
			checkbox.onclick = function() {
				this.checked = !this.checked;
				return true;
			}
		}
		
		foo('A','Coins');
		foo('B','Coins/Gems');
		foo('C','Art');
		foo('D','Coins/Small objects');
		foo('E','Armour and weapons');
		foo('F','Combat gear');
		foo('G','Spellcaster gear');
		foo('H','Lair treasure');
		foo('I','Hoard');
		
		dd = document.createElement('div');
		dd.style.margin = ".5em 0 .5em 0";
		div.appendChild(dd);

		dd.appendChild(document.createTextNode("Max treasure value"));
		
		function addMaxTreasureValue(pct) {
			var radio = document.createElement('input');
			radio.type = "radio";
			radio.name = radioButtonSeq + '-radio';
			radio.value = "value";
			if(pct==100) radio.checked = true;
			dd.appendChild(radio);
			dd.appendChild(document.createTextNode(pct + "%"));
		}
		
		addMaxTreasureValue(100);
		addMaxTreasureValue(80);
		addMaxTreasureValue(66);
		addMaxTreasureValue(50);
		addMaxTreasureValue(25);
		addMaxTreasureValue(10);
		
		radioButtonSeq++;
	}
	
	TreasureTypeSelector.prototype.toString = function() {
		return "TreasureTypeSelector for " + this.overallBlock;
	}
	
	TreasureTypeSelector.prototype.selectTreasureType = function(types) {
		for(var i = 'A'.charCodeAt(0); i<='I'.charCodeAt(0);i++) {
			var t = String.fromCharCode(i);
			this.checkboxes[t].checked = types.indexOf(t) != -1
		}
	}
	
	function TreasureBlock(div, overallTreasureBlock, treasureIndex) {
		this.div = div;
		this.overallTreasureBlock = overallTreasureBlock;
		this.treasureIndex = treasureIndex;
		
		// the current state
		this.type = null;
		this.budget = 1000;
		this.allocation = null; // the currently selected allocation
		
		div.controller = this;
		div.appendChild(document.createTextNode('Type:'));
		this.typeSelector = document.createElement('select');

		for(var i = 'A'.charCodeAt(0); i<='I'.charCodeAt(0);i++) {
			var tt = String.fromCharCode(i);
			eee = document.createElement("option");
			eee.text = tt + " - " + treasureTypeLabels[tt];
			eee.value = tt;
			this.typeSelector.appendChild(eee);
		}
		
		div.appendChild(this.typeSelector);
		
		div.appendChild(document.createTextNode('Budget:'));
		this.budgetSelector = document.createElement('select');
		div.appendChild(this.budgetSelector);

		var e
		e = document.createElement("button");
		e.innerHTML = "clear";
		e.onclick = function() {
			controller(this).clear();
		};
		div.appendChild(e);

		e = document.createElement("button");
		e.innerHTML = "reroll";
		e.onclick = function() {
			controller(this).reroll();
		};
		div.appendChild(e);

		e = document.createElement("button");
		e.innerHTML = "delete";
		e.onclick = function() {
			controller(this).delete();
		};
		div.appendChild(e);
		
		this.reroll();
	}
	
	TreasureBlock.prototype.clear = function() {
		this.type = null;
		this.allocation = null; // the currently selected allocation
		this.overallTreasureBlock.calculateBudgetConsumed();	
	}
	
	TreasureBlock.prototype.delete = function() {
		for(var i = this.treasureIndex; i<this.overallTreasureBlock.treasuresCount-1; i++) {
			this.overallTreasureBlock.treasures[i] = this.overallTreasureBlock.treasures[i+1];
			this.overallTreasureBlock.treasures[i].treasureIndex = i;
		}
		
		var tt = this.overallTreasureBlock.treasuresArea;
		while(tt.childNodes.length != 0) {
			tt.removeChild(tt.firstChild);
		}
		this.overallTreasureBlock.treasuresCount --;
		
		for(var i = 0; i<this.overallTreasureBlock.treasuresCount; i++) {
			tt.appendChild(this.overallTreasureBlock.treasures[i].div);
		}
		
		this.overallTreasureBlock.calculateBudgetConsumed();	
	}
	
	TreasureBlock.prototype.getValue = function() {
		// 1000 to stop it blowing up for now
		return this.allocation == null ? 1000 : this.allocation.budget;
	}
	
	TreasureBlock.prototype.setType = function(type) {
		this.clear();
	}
	
	TreasureBlock.prototype.setAllocationIndex = function(index) {
		
	}
	
	TreasureBlock.prototype.setAllocation = function(index) {
		this.reroll();
	}
	
	TreasureBlock.prototype.reroll = function() {
		this.clear();
		
		if(this.overallTreasureBlock.budgetConsumed >= this.overallTreasureBlock.budget) {
			return;
		}

		
		// reroll based on the TreasureTypeSelector belonging to my overallTreasureBlock
		// if there is 
		this.overallTreasureBlock.calculateBudgetConsumed();	
	}
	
	
	// this class holds one cell of table 7-, 7-5 etc. It knows what type it is, how much it is worth, 
	// and how to generate a lump of loot.
	
	function TreasureTypeAllocation(type, budget, description) {
		this.type = type;
		this.budget = budget;
		this.description = description;
	}
	
	TreasureTypeAllocation.prototype.toString = function() {
		return "Treasure type " + this.type + " worth " + this.budget + "gp";
	}
	
	// this global constant holds the known allocations. The arrays are sorted in ascending order of gold, so
	// to find a treasure of type X worth not more than Y, go to the appropriate letter and scan backwards
	
	var treasureTypeAllocations = new Object();
	treasureTypeAllocations.A = new Array();
	treasureTypeAllocations.B = new Array();
	treasureTypeAllocations.C = new Array();
	treasureTypeAllocations.D = new Array();
	treasureTypeAllocations.E = new Array();
	treasureTypeAllocations.F = new Array();
	treasureTypeAllocations.G = new Array();
	treasureTypeAllocations.H = new Array();
	treasureTypeAllocations.I = new Array();

	treasureTypeAllocations.A = [
	new TreasureTypeAllocation('A',     1, '5d10 cp, 3d4 sp'),
	new TreasureTypeAllocation('A',     5, '2d6 × 10 cp, 4d8 sp, 1d4 gp'),
	new TreasureTypeAllocation('A',    10, '5d10 × 10 cp, 5d10 sp, 1d8 gp'),
	new TreasureTypeAllocation('A',    25, '2d4 × 100 cp, 3d6 × 10 sp, 4d4 gp'),
	new TreasureTypeAllocation('A',    50, '4d4 × 100 cp, 4d6 × 10 sp, 8d6 gp'),
	new TreasureTypeAllocation('A',   100, '6d8 × 10 sp, 3d4 × 10 gp'),
	new TreasureTypeAllocation('A',   200, '2d4 × 100 sp, 4d4 × 10 gp, 2d4 pp'),
	new TreasureTypeAllocation('A',   500, '6d6 × 10 gp, 8d6 pp'),
	new TreasureTypeAllocation('A',  1000, '2d4 × 100 gp, 10d10 pp'),
	new TreasureTypeAllocation('A',  5000, '4d8 × 100 gp, 6d10 × 10 pp'),
	new TreasureTypeAllocation('A', 10000, '2d4 × 1,000 gp, 12d8 × 10 pp'),
	new TreasureTypeAllocation('A', 50000, '2d6 × 1,000 gp, 8d10 × 100 pp')
	];
	
	// find the innermost enclosing node that has a "controller" object

	function controller(c) {
		while (c) {
			if (c.controller)
				return c.controller;
			c = c.parentNode;
		}
	}
</script>
<body onload="initAll()">
	<div id="summary"margin:1em; ></div>

	<div style="clear: both;"></div>

	<div id="total treasure value"margin:1em; >
		APL <select id="APL" onchange="recalcTotalTreasureBudget()">
			<option value="1" selected="on">1</option>
			<option value="2">2</option>
			<option value="3">3</option>
			<option value="4">4</option>
			<option value="5">5</option>
			<option value="6">6</option>
			<option value="7">7</option>
			<option value="8">8</option>
			<option value="9">9</option>
			<option value="10">10</option>
			<option value="11">11</option>
			<option value="12">12</option>
			<option value="13">13</option>
			<option value="14">14</option>
			<option value="15">15</option>
			<option value="16">16</option>
			<option value="17">17</option>
			<option value="18">18</option>
			<option value="19">19</option>
			<option value="20">20+</option>
		</select> Amount: <select id="APLMultiplier" onchange="recalcTotalTreasureBudget()">
			<option value="incidental">incidental</option>
			<option value="standard" selected="on">standard</option>
			<option value="double">double</option>
			<option value="triple">triple</option>
		</select> Advancement rate: <select id="AdvancementRate" onchange="recalcTotalTreasureBudget()">
			<option value="slow">slow</option>
			<option value="med" selected="on">medium</option>
			<option value="fast">fast</option>
		</select> Total treasure budget: <span class="money" id="totaltreasurebudget">0</span>

		<button onclick="recalcTotalTreasureBudget()">Reroll all</button>

		<button onclick="addNPCBlock()">Add NPC Block</button>
	</div>


	<div id="MAIN">
		<div id="SUMMARY">
			<div style="float: left; margin: 1em; padding: 1em;  border: thin solid black;">
				<table border="0" cellspacing="0" cellpadding="0">
					<tr>
						<TD></TD>
						<TH>Amt</TH>
						<TH>Value</TH>
					</tr>
					<tr>
						<TD>CP</TD>
						<TD id="cp_amt" class="money">0</TD>
						<TD id="cp_value" class="money">0.00</TD>
					</tr>
					<tr>
						<TD>SP</TD>
						<TD id="sp_amt" class="money">0</TD>
						<TD id="sp_value" class="money">0.00</TD>
					</tr>
					<tr>
						<TD>GP</TD>
						<TD id="gp_amt" class="money">0</TD>
						<TD id="gp_value" class="money">0.00</TD>
					</tr>
					<tr>
						<TD>PP</TD>
						<TD id="pp_amt" class="money">0</TD>
						<TD id="pp_value" class="money">0.00</TD>
					</tr>
					<tr>
						<TD>Subtotal</TD>
						<TD colspan="2" id="currency_value" class="money">0.00</TD>
					</tr>
					<tr>
						<TD>Gems</TD>
						<TD colspan="2" id="gem_value" class="money">0.00</TD>
					</tr>
					<tr>
						<TD>Art Objects</TD>
						<TD colspan="2" id="art_value" class="money">0.00</TD>
					</tr>
					<tr>
						<TD>Total</TD>
						<TD colspan="2" id="total_value" class="money" style="font-weight: bold;">0.00</TD>
					</tr>
				</table>
			</div>

			<div style="float: left;"">
				<div style="margin: 1em; padding: 1em; border: thin solid black;">
					<table border="0" cellspacing="0" cellpadding="0">
						<caption>Gems</caption>
						<tbody id="gem_table">
						</tbody>
					</table>
				</div>
				<div style="margin: 1em; padding: 1em; border: thin solid black;">
					<table border="0" cellspacing="0" cellpadding="0">
						<caption>Art Objects</caption>
						<tbody id="gem_table">
						</tbody>
					</table>
				</div>
			</div>

			<div style="float: left; margin: 1em; padding: 1em; border: thin solid black;">
				<table border="0" cellspacing="0" cellpadding="0">
					<caption>Items</caption>
					<tbody id="item_table">
					</tbody>
				</table>
			</div>

			<div style="float: left;">
				<div style="margin: 1em; padding: 1em; border: thin solid black;">
					<table border="0" cellspacing="0" cellpadding="0">
						<caption>Weapons</caption>
						<tbody id="weapon_table">
						</tbody>
					</table>
				</div>

				<div style="margin: 1em; padding: 1em; border: thin solid black;">
					<table border="0" cellspacing="0" cellpadding="0">
						<caption>Armour</caption>
						<tbody id="armour_table">
						</tbody>
					</table>
				</div>
			</div>
		</div>
		<div style="clear: both;"></div>
		<div id="MAIN-TREASURE"></div>
		<div style="clear: both;"></div>
		<div id="NPC-TREASURES"></div>
	</div>

	<div style="clear: both;"></div>
	<hr>

	<font size="-1"> Paizo Publishing data used without permission. Using this generator without owning a paid-for copy of Ulimte Equipment is a chaotic act! Also, this generator won't be much use to you without one. <br>
		Javascript code &copy; <a href="mailto:Paul Murray<pmurray@bigpond.com">Paul Murray</a> 2014. <a href="http://paulmurray.wordpress.com">Wordpress</a>, <a href="https://twitter.com/#!/PaulMurrayCbr">Twitter</a>, <a
		href="http://www.facebook.com/PaulMurrayCbr">Facebook</a>.
	</font>
</body>
</html>