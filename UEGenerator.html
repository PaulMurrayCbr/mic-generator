<html>
<head>
<title>Ultimate Equipment treasure generator</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- 
	This HTML file is an implementation of the treasure generator in the Paizo's Ultimate Equipment, for the 
	Pathfinder gaming sysytem. UE is copyright Paizo Publishing, and the data therin is used without permission.
	
	The code is copyright (c) 2014 Paul Murray, pmurray@bigpond.com, twitter PaulMurrayCbr, paulmurray.wordpress.com.
	
	License is Creative Commons "non-commercial with attribution"

	(like, yeah right: I will totally sic my lawyers onto you if you diss my rights)
	
 -->

<style type="text/css">
.money {
	border: thin solid gray;
	text-align: right;
	padding-left: .5em;
	padding-right: .5em;
	font-family: monospace;
}

.centercell {
	border: thin solid gray;
	text-align: center;
	padding-left: .5em;
	padding-right: .5em;
}

.cell {
	border: thin solid gray;
	text-align: left;
	padding-left: .5em;
	padding-right: .5em;
}

.cellNoB {
	text-align: left;
	padding-left: .5em;
	padding-right: .5em;
}
</style>

</head>
<script type="text/javascript">
	function initAll() {
		try {
			mainTreasureBlock = new OverallTreasureBlock(document
					.getElementById("MAIN-TREASURE"), 0);
			recalcTotalTreasureBudget();
		} catch (e) {
			alert("initAll " + e);
		}
	}

	// a global.

	var totalTreasureBudget = 0;

	var t7_1_slow = [ 0, 170, 350, 550, 750, 1000, 1350, 1750, 2200, 2850,
			3650, 4650, 6000, 7750, 10000, 13000, 16500, 22000, 28000, 35000,
			44000 ];
	var t7_1_medium = [ 0, 260, 550, 800, 1150, 1550, 2000, 3600, 3350, 4250,
			5450, 7000, 9000, 11600, 15000, 19500, 25000, 32000, 41000, 53000,
			67000 ];
	var t7_1_fast = [ 0, 4000, 8000, 1200, 1700, 2300, 3000, 3900, 5000, 6400,
			8200, 10500, 13500, 17500, 22000, 29000, 38000, 48000, 62000,
			79000, 100000 ];

	var mainTreasureBlock;
	
	var npcCount = 0;
	var npcList = new Array();

	function recalcTotalTreasureBudget() {
		try {
			var apl = parseInt(document.getElementById("APL").value);
			var track;
			if (document.getElementById("AdvancementRate").value == 'slow') {
				track = t7_1_slow;
			} else if (document.getElementById("AdvancementRate").value == 'fast') {
				track = t7_1_fast;
			} else {
				track = t7_1_medium;
			}

			totalTreasureBudget = track[apl];

			if (document.getElementById("APLMultiplier").value == 'incidental') {
				totalTreasureBudget /= 2;
			} else if (document.getElementById("APLMultiplier").value == 'double') {
				totalTreasureBudget *= 2;
			} else if (document.getElementById("APLMultiplier").value == 'triple') {
				totalTreasureBudget *= 3;
			}

			document.getElementById("totaltreasurebudget").innerHTML = totalTreasureBudget;
			
			var mainBudget = totalTreasureBudget;
			
			for(var i = 0; i<npcCount; i++) {
				mainBudget -= npcList[i].budget;
			}

			mainTreasureBlock.setBudget(mainBudget);

		} catch (e) {
			alert("recalcTotalTreasureBudget: " + e);
		}
	}
	
	function repopulateSummary() {
		try {
		} catch (e) {
			alert("repopulateSummary: " + e);
		}
		
	}
	
	function addNPCBlock() {
		try {
			var div = document.createElement('div');
			npcList[npcCount] = new OverallTreasureBlock(div, 100, true, npcCount);
			npcCount ++;
			document.getElementById('NPC-TREASURES').appendChild(div);
			recalcTotalTreasureBudget();
		} catch (e) {
			alert("addNPCBlock: " + e);
		}
	}
	
	var T7_2 = [0,260,390,780,1650,2400,3450,4650,6000,7800,10050,12750,16350,21000,27000,34800,45000,58500,75000,96000,123000,159000];
	
	function OverallTreasureBlock(div, budget, isNPCBlock, npcIndex) {
		try {
			this.div = div;
			this.isNPCBlock = isNPCBlock;
			this.npcIndex = npcIndex;
			div.controller = this;

			var e;
			var ee;
			var eee;

			div.appendChild(document.createElement("hr"));

			if(isNPCBlock) {
				e = document.createElement("span")
				e.appendChild(document.createTextNode("NPC Level: "));
				ee = document.createElement("select");
				for(var i = 1; i<=21;i++) {
					eee = document.createElement("option");
					eee.text = i;
					eee.value = i;
					ee.appendChild(eee);
				}
				e.appendChild(ee);
				ee.onchange = function() {
					try {
						controller(this).setBudget(T7_2[parseInt(ee.value)]);
						recalcTotalTreasureBudget();
					}
					catch(ex)  {
						alert("npc level onchange: " + ex);	
					}
				};
				
				div.appendChild(e);
				budget = T7_2[1];
			}
			
			
			e = document.createElement("span")
			e.appendChild(document.createTextNode("Budget: "))
			this.budgetSpan = document.createElement("span");
			e.appendChild(this.budgetSpan);

			div.appendChild(e);

			e = document.createElement("button");
			e.innerHTML = "reroll";
			e.onclick = function() {
				try {
					controller(this).reroll();
				}
				catch(e) {
					alert("reroll onclick: " + e);
				}
			};

			div.appendChild(e);

			if(isNPCBlock) {
				e = document.createElement("button");
				e.innerHTML = "delete";
				e.onclick = function() {
					try {
						controller(this).delete();
					}
					catch(e) {
						alert("reroll delete: " + e);
					}
				};
				div.appendChild(e);
				div.appendChild(document.createElement("br"));
			}
			
			this.chooseTypeArea = document.createElement("div");
			div.appendChild(this.chooseTypeArea);
			this.genArea = document.createElement("div");
			div.appendChild(this.genArea);

			this.setBudget(budget);
		} catch (e) {
			alert("OverallTreasureBlock(div, budget): " + e);

		}
	}

	OverallTreasureBlock.prototype.reroll = function() {
		try {
			this.genArea.innerHTML = new Date();
			repopulateSummary();
		} catch (e) {
			alert("OverallTreasureBlock.prototype.reroll: " + e);

		}
	}

	OverallTreasureBlock.prototype.delete = function() {
		try {
			for(var i = this.npcIndex; i<npcCount-1; i++) {
				npcList[i] = npcList[i+1];
				npcList[i].npcIndex = i;
			}
			
			var tt = document.getElementById('NPC-TREASURES');
			while(tt.childNodes.length != 0) {
				tt.removeChild(tt.firstChild);
			}
			npcCount --;
			
			for(var i = 0; i<npcCount; i++) {
				tt.appendChild(npcList[i].div);
			}
			
			repopulateSummary(); // redundant, because recalc does this anyway.
			
			recalcTotalTreasureBudget();
		} catch (e) {
			alert("OverallTreasureBlock.prototype.delete: " + e);
		}
	}
	
	OverallTreasureBlock.prototype.setBudget = function(budget) {
		try {
			this.budget = budget;
			this.budgetSpan.innerHTML = budget;
			this.reroll();
		} catch (e) {
			alert("OverallTreasureBlock.prototype.setBudge: " + e);

		}
	}

	// find the innermost enclosing node that has a "controller" object

	function controller(c) {
		while (c) {
			if (c.controller)
				return c.controller;
			c = c.parentNode;
		}
	}
</script>
<body onload="initAll()">
	<div id="summary"margin:1em; ></div>

	<div style="clear: both;"></div>

	<div id="total treasure value"margin:1em; >
		APL <select id="APL" onchange="recalcTotalTreasureBudget()">
			<option value="1" selected="on">1</option>
			<option value="2">2</option>
			<option value="3">3</option>
			<option value="4">4</option>
			<option value="5">5</option>
			<option value="6">6</option>
			<option value="7">7</option>
			<option value="8">8</option>
			<option value="9">9</option>
			<option value="10">10</option>
			<option value="11">11</option>
			<option value="12">12</option>
			<option value="13">13</option>
			<option value="14">14</option>
			<option value="15">15</option>
			<option value="16">16</option>
			<option value="17">17</option>
			<option value="18">18</option>
			<option value="19">19</option>
			<option value="20">20+</option>
		</select> Amount: <select id="APLMultiplier" onchange="recalcTotalTreasureBudget()">
			<option value="incidental">incidental</option>
			<option value="standard" selected="on">standard</option>
			<option value="double">double</option>
			<option value="triple">triple</option>
		</select> Advancement rate: <select id="AdvancementRate" onchange="recalcTotalTreasureBudget()">
			<option value="slow">slow</option>
			<option value="med" selected="on">medium</option>
			<option value="fast">fast</option>
		</select> Total treasure budget: <span class="money" id="totaltreasurebudget">0</span>

		<button onclick="recalcTotalTreasureBudget()">Reroll all</button>

		<button onclick="addNPCBlock()">Add NPC Block</button>
	</div>


	<div id="MAIN">
		<div id="SUMMARY">
			<div style="float: left; margin: 1em; padding: 1em; Â border: thin solid black;">
				<table border="0" cellspacing="0" cellpadding="0">
					<tr>
						<TD></TD>
						<TH>Amt</TH>
						<TH>Value</TH>
					</tr>
					<tr>
						<TD>CP</TD>
						<TD id="cp_amt" class="money">0</TD>
						<TD id="cp_value" class="money">0.00</TD>
					</tr>
					<tr>
						<TD>SP</TD>
						<TD id="sp_amt" class="money">0</TD>
						<TD id="sp_value" class="money">0.00</TD>
					</tr>
					<tr>
						<TD>GP</TD>
						<TD id="gp_amt" class="money">0</TD>
						<TD id="gp_value" class="money">0.00</TD>
					</tr>
					<tr>
						<TD>PP</TD>
						<TD id="pp_amt" class="money">0</TD>
						<TD id="pp_value" class="money">0.00</TD>
					</tr>
					<tr>
						<TD>Subtotal</TD>
						<TD colspan="2" id="currency_value" class="money">0.00</TD>
					</tr>
					<tr>
						<TD>Gems</TD>
						<TD colspan="2" id="gem_value" class="money">0.00</TD>
					</tr>
					<tr>
						<TD>Art Objects</TD>
						<TD colspan="2" id="art_value" class="money">0.00</TD>
					</tr>
					<tr>
						<TD>Total</TD>
						<TD colspan="2" id="total_value" class="money" style="font-weight: bold;">0.00</TD>
					</tr>
				</table>
			</div>

			<div style="float: left;"">
				<div style="margin: 1em; padding: 1em; border: thin solid black;">
					<table border="0" cellspacing="0" cellpadding="0">
						<caption>Gems</caption>
						<tbody id="gem_table">
						</tbody>
					</table>
				</div>
				<div style="margin: 1em; padding: 1em; border: thin solid black;">
					<table border="0" cellspacing="0" cellpadding="0">
						<caption>Art Objects</caption>
						<tbody id="gem_table">
						</tbody>
					</table>
				</div>
			</div>

			<div style="float: left; margin: 1em; padding: 1em; border: thin solid black;">
				<table border="0" cellspacing="0" cellpadding="0">
					<caption>Items</caption>
					<tbody id="item_table">
					</tbody>
				</table>
			</div>

			<div style="float: left;">
				<div style="margin: 1em; padding: 1em; border: thin solid black;">
					<table border="0" cellspacing="0" cellpadding="0">
						<caption>Weapons</caption>
						<tbody id="weapon_table">
						</tbody>
					</table>
				</div>

				<div style="margin: 1em; padding: 1em; border: thin solid black;">
					<table border="0" cellspacing="0" cellpadding="0">
						<caption>Armour</caption>
						<tbody id="armour_table">
						</tbody>
					</table>
				</div>
			</div>
		</div>
		<div style="clear: both;"></div>
		<div id="MAIN-TREASURE"></div>
		<div style="clear: both;"></div>
		<div id="NPC-TREASURES"></div>
	</div>

	<div style="clear: both;"></div>
	<hr>

	<font size="-1"> Paizo Publishing data used without permission. Using this generator without owning a paid-for copy of Ulimte Equipment is a chaotic act! Also, this generator won't be much use to you without one. <br>
		Javascript code &copy; <a href="mailto:Paul Murray<pmurray@bigpond.com">Paul Murray</a> 2014. <a href="http://paulmurray.wordpress.com">Wordpress</a>, <a href="https://twitter.com/#!/PaulMurrayCbr">Twitter</a>, <a
		href="http://www.facebook.com/PaulMurrayCbr">Facebook</a>.
	</font>
</body>
</html>