<html>
<head>
<title>Ultimate Equipment treasure generator</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- 
	This HTML file is an implementation of the treasure generator in the Paizo's Ultimate Equipment, for the 
	Pathfinder gaming sysytem. UE is copyright Paizo Publishing, and the data therin is used without permission.
	
	The code is copyright (c) 2014 Paul Murray, pmurray@bigpond.com, twitter PaulMurrayCbr, paulmurray.wordpress.com.
	
	License is Creative Commons "non-commercial with attribution"

	(like, yeah right: I will totally sic my lawyers onto you if you diss my rights)
	
 -->

<style type="text/css">
.money {
	border: thin solid gray;
	text-align: right;
	padding-left: .5em;
	padding-right: .5em;
	font-family: monospace;
}

.centercell {
	border: thin solid gray;
	text-align: center;
	padding-left: .5em;
	padding-right: .5em;
}

.cell {
	border: thin solid gray;
	text-align: left;
	padding-left: .5em;
	padding-right: .5em;
}

.cellNoB {
	text-align: left;
	padding-left: .5em;
	padding-right: .5em;
}
</style>

</head>
<script type="text/javascript">

	var picker; // I use this as a scrpa variable in a couple of spots


	function clearElement(e) {
		while(e.childNodes.length != 0) {
			e.removeChild(e.firstChild);
		}
	}

	function initAll() {
		mainTreasureBlock = new OverallTreasureBlock(document
				.getElementById("MAIN-TREASURE"), 0);
		npcCount = 0;
		recalcTotalTreasureBudget();
	}
	
	// UTILITY OBJECTS
	
	
	function rnd(dd) {
		var r = Math.random();
		r = r * dd
		r = Math.floor(r)
		return r;
	}

	function roll(n, dd) {
		var t = 0;
		while (n > 0) {
			n--;
			t += rnd(dd) + 1;
		}
		return t;
	}

	function DiceRoller(n, d, plus) {
		if (d == 0)
			throw "Cant do a d0";

		this.n = n;
		this.d = d;
		this.plus = plus;
	}

	DiceRoller.prototype.toString = function() {
		try {
			return this.n
					+ "d"
					+ this.d
					+ (this.plus == 0 ? "" : this.plus > 0 ? "+" + this.plus
							: this.plus);
		} catch (ex) {
			return ex.toString();
		}
	}

	DiceRoller.prototype.gen = function() {
		var rolls = [];
		var amt = this.plus;
		
		for ( var i = 0; i < this.n; i++) {
			rolls[i] = roll(1, this.d);
			amt += rolls[i];
		}

		return new DiceRoll(this, rolls, amt);
	}

	function DiceRoll(gen, rolls, amt) {
		this.gen = gen;
		this.rolls = rolls;
		this.amt = amt;
	}

	DiceRoll.prototype.toString = function() {
		try {
			return this.gen + "(" + this.rolls + ")=" + this.amt;
		} catch (ex) {
			return ex.toString();
		}

	}
	
	function cpToString(cp) {
		return Math.floor(cp/100) + "." + Math.floor((cp%100)/10) + Math.floor((cp%10))
	}
	

	/////////////////////////////////////////////////////////////////////////////////////////////////////////
	/////////////////////////////////////////////////////////////////////////////////////////////////////////
	/////////////////////////////////////////////////////////////////////////////////////////////////////////

	var d100roller = new DiceRoller(1, 100, 0);

	function D100Picker(v) {
		this.v = v;
		if(!v) { throw "D100Picker("+v+")";}
	}

	D100Picker.prototype.toString = function() {return "D100Picker( " + this.v +")";}

	D100Picker.prototype.add = function(a, b, item) {
		if(!item) throw "no item for D100.add";
		var row = new D100Row(this, a, b, item);
		for(var i = a; i<= b; i++) {
			this.v[i] = row;
		}
	}

	D100Picker.prototype.gen = function() {
		return new D100Pick(this, d100roller.gen());
	}

	D100Picker.prototype.validate = function(msg) {
		for(var i = 1; i < 100; i++) {
			if(!this.v[i]) {
				throw "D100 validation fail: no item " + i + " on " + this + ": " + msg;
			}	
		}
	}

	function D100Row(gen, a, b, item) {
		this.gen = gen;
		this.a = a;
		this.b = b;
		this.item = item;
		
		if(!gen) throw "no gen for d100Row";
		if(!item) throw "no item for d100Row";
	}
	
	D100Row.prototype.toString = function() {try{return "D100Row("+this.a+"-" + this.b + ": " + this.item.toString()+")";}catch(ex){return ex;}}

	function D100Pick(gen, roll) {
		this.gen = gen;
		this.roll = roll;
		this.v = gen.v;
		
		this.row = this.v[roll.amt];
		
		if(!this.row) throw (this + " failed to have value for " + roll); 
		
		this.item = this.row.item;
		
		if(this.item.gen) {
			this.generated = this.item.gen(gen);
		}
		else {
			this.generated = this.item;
		}
	}

	D100Pick.prototype.toString = function() {try{
		
		var g,r,rr,gg;
		try {g = this.gen.toString();}catch(e){g=e.toString();}
		try {r = this.roll.toString();}catch(e){g=e.toString();}
		try {rr = this.row.toString();}catch(e){g=e.toString();}
		try {gg = this.generated.toString();}catch(e){gg=e.toString();}
		
		return "D100Pick(" + g + "["+r+"]: " + rr + ": " + gg + ")";
		}catch(ex){return ex;}}

	D100Pick.prototype.reroll = function() {
		this.roll = d100roller.gen();
		this.row = this.v[this.roll.amt];
		this.item = this.row.item;
		this.generated = this.item.gen();
	}

	/////////////////////////////////////////////////////////////////////////////////////////////////////////
	/////////////////////////////////////////////////////////////////////////////////////////////////////////
	/////////////////////////////////////////////////////////////////////////////////////////////////////////

	
	//////////	
	
	// a global.

	var totalTreasureBudget = 0;

	var t7_1_slow = [ 0, 170, 350, 550, 750, 1000, 1350, 1750, 2200, 2850,
			3650, 4650, 6000, 7750, 10000, 13000, 16500, 22000, 28000, 35000,
			44000 ];
	var t7_1_medium = [ 0, 260, 550, 800, 1150, 1550, 2000, 3600, 3350, 4250,
			5450, 7000, 9000, 11600, 15000, 19500, 25000, 32000, 41000, 53000,
			67000 ];
	var t7_1_fast = [ 0, 4000, 8000, 1200, 1700, 2300, 3000, 3900, 5000, 6400,
			8200, 10500, 13500, 17500, 22000, 29000, 38000, 48000, 62000,
			79000, 100000 ];

	var mainTreasureBlock;
	
	var npcCount = 0;
	var npcList = new Array();
	
	
	var summaryCP;
	var summarySP;
	var summaryGP;
	var summaryPP;
	var summaryGEMS;
	var summaryART;
	

	function recalcTotalTreasureBudget() {
		var apl = parseInt(document.getElementById("APL").value);
		var track;
		if (document.getElementById("AdvancementRate").value == 'slow') {
			track = t7_1_slow;
		} else if (document.getElementById("AdvancementRate").value == 'fast') {
			track = t7_1_fast;
		} else {
			track = t7_1_medium;
		}

		totalTreasureBudget = track[apl];

		if (document.getElementById("APLMultiplier").value == 'incidental') {
			totalTreasureBudget /= 2;
		} else if (document.getElementById("APLMultiplier").value == 'double') {
			totalTreasureBudget *= 2;
		} else if (document.getElementById("APLMultiplier").value == 'triple') {
			totalTreasureBudget *= 3;
		}

		document.getElementById("totaltreasurebudget").innerHTML = totalTreasureBudget;
		
		var mainBudget = totalTreasureBudget;
		
		for(var i = 0; i<npcCount; i++) {
			mainBudget -= npcList[i].budget;
		}

		mainTreasureBlock.setBudget(mainBudget);
	}
	
	function repopulateSummary() {
		
		summaryCP=0;
		summarySP=0;
		summaryGP=0;
		summaryPP=0;
		summaryGEMS=0;
		summaryART=0;

		
		document.getElementById('cp_amt').innerHTML = '0';
		document.getElementById('cp_value').innerHTML = '0.00';
		document.getElementById('sp_amt').innerHTML = '0';
		document.getElementById('sp_value').innerHTML = '0.00';
		document.getElementById('gp_amt').innerHTML = '0';
		document.getElementById('gp_value').innerHTML = '0.00';
		document.getElementById('pp_amt').innerHTML = '0';
		document.getElementById('pp_value').innerHTML = '0.00';

		document.getElementById('currency_value').innerHTML = '0.00';
		document.getElementById('gem_value').innerHTML = '0.00';
		document.getElementById('art_value').innerHTML = '0.00';
		document.getElementById('total_value').innerHTML = '0.00';
		
		clearElement(document.getElementById('gem_table'));
		clearElement(document.getElementById('art_table'));
		clearElement(document.getElementById('item_table'));
		clearElement(document.getElementById('weapon_table'));
		clearElement(document.getElementById('armour_table'));
		
		if(!mainTreasureBlock) return; // this only happens during the initial page load
		addTreasureBlockToSummary(mainTreasureBlock);
		for(var i = 0; i<npcCount;i++) {
			addTreasureBlockToSummary(npcList[i]);
		}
	}
	
	function addTreasureBlockToSummary(treasureBlock) {
		for(var i = 0; i<treasureBlock.treasuresCount; i++) {
			addTreasureToSummary(treasureBlock.treasures[i]);
		}
	}
	
	function addTreasureToSummary(treasure) {
		for(var i = 0; i<treasure.generatedGold.length; i++) {
			var generatedGold = treasure.generatedGold[i]
			
			if(generatedGold.picker.denom == cp) {
				summaryCP += generatedGold.picker.mul * generatedGold.roll.amt;
			}
			else if(generatedGold.picker.denom == sp) {
				summarySP += generatedGold.picker.mul * generatedGold.roll.amt;
			}
			else if(generatedGold.picker.denom == gp) {
				summaryGP += generatedGold.picker.mul * generatedGold.roll.amt;
			}
			else if(generatedGold.picker.denom == pp) {
				summaryPP += generatedGold.picker.mul * generatedGold.roll.amt;
			}
			else {
				document.getElementById('sp_value').innerHTML = new Date() 
			}
			
			
		}

		for(var i = 0; i<treasure.generatedGems.length; i++) {
			var generatedGems = treasure.generatedGems[i]
			var span = document.createElement("div");
			span.style.margin = "2px";
			span.style.padding = "2px";
			span.appendChild(document.createTextNode(generatedGems));
			document.getElementById('gem_table').appendChild(span);
			summaryGEMS += generatedGems.getValue();
		}
		for(var i = 0; i<treasure.generatedArt.length; i++) {
			var generatedArt = treasure.generatedArt[i]
			var span = document.createElement("div");
			span.style.margin = "2px";
			span.style.padding = "2px";
			span.appendChild(document.createTextNode(generatedArt));
			document.getElementById('art_table').appendChild(span);
			summaryART += generatedArt.getValue();
		}
		for(var i = 0; i<treasure.generatedItems.length; i++) {
			var generatedItem = treasure.generatedItems[i]
			var span = document.createElement("div");
			span.style.margin = "2px";
			span.style.padding = "2px";
			span.appendChild(document.createTextNode(generatedItem));
			document.getElementById('item_table').appendChild(span);
		}
		for(var i = 0; i<treasure.generatedWeapons.length; i++) {
			var generatedWeapon = treasure.generatedWeapons[i]
			var span = document.createElement("div");
			span.style.margin = "2px";
			span.style.padding = "2px";
			span.appendChild(document.createTextNode(generatedWeapon));
			document.getElementById('weapon_table').appendChild(span);
		}
		for(var i = 0; i<treasure.generatedArmour.length; i++) {
			var generatedArmour = treasure.generatedArmour[i]
			var span = document.createElement("div");
			span.style.margin = "2px";
			span.style.padding = "2px";
			span.appendChild(document.createTextNode(generatedArmour));
			document.getElementById('armour_table').appendChild(span);
		}
		
		document.getElementById('cp_amt').innerHTML = summaryCP;
		document.getElementById('cp_value').innerHTML = cpToString(summaryCP);
		document.getElementById('sp_amt').innerHTML = summarySP;
		document.getElementById('sp_value').innerHTML = cpToString(summarySP*10);
		document.getElementById('gp_amt').innerHTML = summaryGP;
		document.getElementById('gp_value').innerHTML = cpToString(summaryGP*100);
		document.getElementById('pp_amt').innerHTML = summaryPP;
		document.getElementById('pp_value').innerHTML = cpToString(summaryPP*1000);
		document.getElementById('currency_value').innerHTML = cpToString(summaryCP+summarySP*10+summaryGP*100+summaryPP*1000);
		document.getElementById('gem_value').innerHTML = cpToString(summaryGEMS*100);
		document.getElementById('art_value').innerHTML = cpToString(summaryART*100);
		document.getElementById('total_value').innerHTML = cpToString(summaryCP+summarySP*10+summaryGP*100+summaryPP*1000+summaryGEMS*100+summaryART*100);
		
	}

	
	function addNPCBlock() {
		var div = document.createElement('div');
		npcList[npcCount] = new OverallTreasureBlock(div, 100, true, npcCount);
		npcCount ++;
		document.getElementById('NPC-TREASURES').appendChild(div);
		recalcTotalTreasureBudget();
	}
	
	var T7_2 = [0,260,390,780,1650,2400,3450,4650,6000,7800,10050,12750,16350,21000,27000,34800,45000,58500,75000,96000,123000,159000];
	
	function OverallTreasureBlock(div, budget, isNPCBlock, npcIndex) {
		this.div = div;
		this.isNPCBlock = isNPCBlock;
		this.npcIndex = npcIndex;
		div.controller = this;

		this.treasures = new Array();
		this.treasuresCount = 0;
		
		var e;
		var ee;
		var eee;

		div.appendChild(document.createElement("hr"));

		if(isNPCBlock) {
			e = document.createElement("span")
			e.appendChild(document.createTextNode("NPC Level: "));
			ee = document.createElement("select");
			for(var i = 1; i<=21;i++) {
				eee = document.createElement("option");
				eee.text = i;
				eee.value = i;
				ee.appendChild(eee);
			}
			e.appendChild(ee);
			ee.onchange = function() {
				controller(this).setBudget(T7_2[parseInt(ee.value)]);
				recalcTotalTreasureBudget();
			};
			
			div.appendChild(e);
			budget = T7_2[1];
		}
		
		
		e = document.createElement("span")
		e.appendChild(document.createTextNode("Budget: "))
		this.budgetSpan = document.createElement("span");
		e.appendChild(this.budgetSpan);
		e.appendChild(document.createTextNode(", Consumed: "))
		this.budgetConsumedSpan = document.createElement("span");
		e.appendChild(this.budgetConsumedSpan);

		div.appendChild(e);

		var treasureType = document.createElement("div");
		div.appendChild(treasureType);
		
		this.chooseTypeArea = document.createElement("div");
		div.appendChild(this.chooseTypeArea);
		this.treasureTypeSelector = new TreasureTypeSelector(this, this.chooseTypeArea);
		
		e = document.createElement("button");
		e.innerHTML = "add one treasure";
		e.onclick = function() {
			controller(this).addOne();
		};
		div.appendChild(e);

		e = document.createElement("button");
		e.innerHTML = "reroll all";
		e.onclick = function() {
			controller(this).reroll();
		};
		div.appendChild(e);

		if(isNPCBlock) {
			e = document.createElement("button");
			e.innerHTML = "delete NPC";
			e.onclick = function() {
					controller(this).delete();
			};
			div.appendChild(e);
		}

		this.treasuresArea = document.createElement("div");
		div.appendChild(this.treasuresArea);

		this.setBudget(budget);
	}

	OverallTreasureBlock.prototype.toString = function() {
		return "OverallTreasureBlock" + ((this.npcIndex+1)? " for NPC " + (this.npcIndex+1) : "");
	}
	
	OverallTreasureBlock.prototype.reroll = function() {
		while(this.treasuresCount > 0) {
			this.treasures[0].delete();
		}
		
		var noMoreThan20 = 20;		
		while(this.budgetConsumed < this.budget && noMoreThan20-- > 0) {
			if(!this.addOne()) {
				break;
			}
		}
		
		this.calculateBudgetConsumed();
		repopulateSummary();
	}

	OverallTreasureBlock.prototype.addOne = function() {
		// ok. How much budge do we have remainning?
				
		var d = document.createElement('div');
		this.treasuresArea.appendChild(d);
		
		var treasureBlock =  new TreasureBlock(d, this, this.treasuresCount);
		this.treasures[this.treasuresCount] = treasureBlock;
		this.treasuresCount++;
		
		var budgetRemaining = this.budget - this.budgetConsumed;
		
		var chosenType = 'A'
			var chosenIndex = -1

		chooseComboSettings: {
			if(budgetRemaining <= 0) break chooseComboSettings;
			
			var cheese = 100;
			for(var i = 0; i<this.treasureTypeSelector.howMuchCheese.length;i++ ) {
				var cheesyButton = this.treasureTypeSelector.howMuchCheese[i];
				if(cheesyButton.checked) {
					cheese = parseInt(cheesyButton.data_ming);
				}
			}
			
				
			// do this in two rounds. 
			// first, use the cheese limit. 
			// If that fails, use maximmum cheese. 
			for(var zz=0;chosenIndex == -1 && zz<=1;zz++) {
				var maximumBudget;
				if(zz == 0) {
					maximumBudget = this.budget*cheese/100
					if(maximumBudget > budgetRemaining) {
						maximumBudget = budgetRemaining
					}
				}
				else {
					maximumBudget = budgetRemaining
				}
				// ok. What lists does the user want me to pick from?
				var types = this.treasureTypeSelector.getSelectedTypes();
				
				while(types.length > 0 && chosenIndex == -1) {
					var idx = rnd(types.length);
					chosenType = types[idx];
					types.splice(idx, 1);
					chosenIndex = pickATreasureFromList(chosenType, maximumBudget)
				}
				
			}

			// nothing worked. Meh - add moneys.
			if(chosenIndex != -1) {
				treasureBlock.typeSelector.value = chosenType;
				treasureBlock.setType(chosenType);
				treasureBlock.budgetSelector.value = chosenIndex;
				treasureBlock.setAllocationIndex(chosenIndex);
			}			
		}
		
		treasureBlock.reroll();
		return chosenIndex != -1;
	}
	
	function pickATreasureFromList(whichList, maximumBudget) {
		var list = treasureTypeAllocations[whichList]
		if(list[0].budget > maximumBudget) return -1;
		
		var biggestBudget = list[0].budget;
		var biggestBudgetCount = 1;
		var biggestBudgetStartPoint = 0;
		
		for(var i = 1; i<list.length; i++) {
			if(list[i].budget > maximumBudget) {
				break;
			}
			else if(list[i].budget == biggestBudget) {
				biggestBudgetCount ++;
			}
			else {
				biggestBudget = list[i].budget;
				biggestBudgetCount = 1;
				biggestBudgetStartPoint = i;
			}
		}

		// pick one of the items at that budget point.
		return biggestBudgetStartPoint + rnd(biggestBudgetCount);
	}

	OverallTreasureBlock.prototype.calculateBudgetConsumed = function() {
		this.budgetConsumed = 0;
		
		for(var i =0; i<this.treasuresCount; i++) {
			this.budgetConsumed += this.treasures[i].getValue();
		}
		
		this.budgetConsumedSpan.innerHTML = this.budgetConsumed;
		if(this.budgetConsumed > this.budget) {
			this.budgetConsumedSpan.style.color = 'red'
		}
		else
		if(this.budgetConsumed < this.budget) {
			this.budgetConsumedSpan.style.color = 'black'
		}
		else {
			this.budgetConsumedSpan.style.color = 'blue'
		}
		
		// if we are recalculating the budget consumed, then something has changed.
		repopulateSummary();
	}

	OverallTreasureBlock.prototype.delete = function() {
		for(var i = this.npcIndex; i<npcCount-1; i++) {
			npcList[i] = npcList[i+1];
			npcList[i].npcIndex = i;
		}
		
		npcCount --;

		var tt = document.getElementById('NPC-TREASURES');
		clearElement(tt);
		for(var i = 0; i<npcCount; i++) {
			tt.appendChild(npcList[i].div);
		}
		
		repopulateSummary(); // redundant, because recalc does this anyway.
		
		recalcTotalTreasureBudget();
	}
	
	OverallTreasureBlock.prototype.setBudget = function(budget) {
		this.budget = budget;
		this.budgetSpan.innerHTML = budget;
		this.reroll();
	}
	
	var radioButtonSeq = 0;
	
	var treasureTypeLabels = {
			'A':'Coins',
			'B':'Coins/Gems',
			'C':'Art',
			'D':'Coins/Small objects',
			'E':'Armour and weapons',
			'F':'Combat gear',
			'G':'Spellcaster gear',
			'H':'Lair treasure',
			'I':'Hoard'
	};
	
	
	function TreasureTypeSelector(overallBlock, div) {
		this.overallBlock = overallBlock;
		this.div = div;
		div.controller = this;
		var dd;
		
		dd = document.createElement('div');
		div.appendChild(dd);
		dd.style.margin = ".5em 0 .5em 0";
		
		function creaturetype(name, treasure, extra, extratreasure) {
			var lbl = document.createElement('span');
			lbl.appendChild(document.createTextNode(name))
			
			if(extra) {
				var lbl2 = document.createElement('span');
				lbl2.appendChild(document.createTextNode(" (" + extra + ")"))
				lbl.appendChild(lbl2);
				lbl2.onclick = function(event) { 
					controller(this).selectTreasureType(treasure + extratreasure); 
					event.cancelBubble = true;
				}
			}
			lbl.style.border = 'thin solid darkGray';
			lbl.style.margin = '1px';
			lbl.style.padding = '1px';
			lbl.style.cursor = 'pointer';
			lbl.onclick = function(event) { 
				controller(this).selectTreasureType(treasure); 
			}
			dd.appendChild(lbl);
		}
		
		creaturetype('Aberration', 'ABE', 'cunning', 'FHG');
		creaturetype('Animal', 'ABDE');
		creaturetype('Construct', 'EF', 'guarding loot', 'BCH');
		creaturetype('Dragon', 'ABCHI');
		creaturetype('Fey', 'BCDG');
		creaturetype('Humanoid', 'ABDEFG', 'entire community', 'H');
		creaturetype('Magical beast', 'ABDE');
		creaturetype('Monstrous humanoid', 'ABCDEH');
		creaturetype('Ooze', 'ABD');
		creaturetype('Outsider', '');
		creaturetype('Plant', 'ABDE');
		creaturetype('Undead', 'ABDE', 'intelligent', 'FG');
		creaturetype('Vermin', 'ABD');
		
		dd = document.createElement('div');
		dd.style.margin = ".5em 0 .5em 0";
		div.appendChild(dd);

		this.checkboxes = new Object();
		var thischeckboxes = this.checkboxes;
		
		for(var i = 'A'.charCodeAt(0); i<='I'.charCodeAt(0);i++) {
			var type = String.fromCharCode(i);
			var lbl = document.createElement('span');
			var checkbox = document.createElement('input');
			checkbox.type = "checkbox";
			lbl.appendChild(checkbox);
			lbl.appendChild(document.createTextNode(type + " - " + treasureTypeLabels[type]));
			lbl.style.border = 'thin solid darkGray';
			lbl.style.margin = '1px';
			lbl.style.padding = '1px';
			lbl.style.cursor = 'pointer';
			lbl.mycheckbox = checkbox;
			
			thischeckboxes[type] = checkbox;
			
			lbl.onclick = function() {
				this.mycheckbox.checked = !this.mycheckbox.checked;
				return true;
			}
			
			dd.appendChild(lbl);
			
			checkbox.onclick = function() {
				this.checked = !this.checked;
				return true;
			}
		}
		
		dd = document.createElement('div');
		dd.style.margin = ".5em 0 .5em 0";
		div.appendChild(dd);

		dd.appendChild(document.createTextNode("Max individual treasure value"));
		
		this.howMuchCheese = [];
		var howMuchCheese = this.howMuchCheese;
		
		function addMaxTreasureValue(pct) {
			var radio = document.createElement('input');
			radio.data_ming = pct
			radio.type = "radio";
			radio.name = radioButtonSeq + '-radio';
			radio.value = "value";
			if(pct==100) radio.checked = true;
			dd.appendChild(radio);
			dd.appendChild(document.createTextNode(pct + "%"));
			howMuchCheese.push(radio);
		}
		
		addMaxTreasureValue(100);
		addMaxTreasureValue(80);
		addMaxTreasureValue(66);
		addMaxTreasureValue(50);
		addMaxTreasureValue(25);
		addMaxTreasureValue(10);
		
		radioButtonSeq++;
	}
	
	TreasureTypeSelector.prototype.toString = function() {
		return "TreasureTypeSelector for " + this.overallBlock;
	}
	
	TreasureTypeSelector.prototype.selectTreasureType = function(types) {
		for(var i = 'A'.charCodeAt(0); i<='I'.charCodeAt(0);i++) {
			var t = String.fromCharCode(i);
			this.checkboxes[t].checked = types.indexOf(t) != -1
		}
	}
	
	TreasureTypeSelector.prototype.getSelectedTypes = function() {
		var selected = [];

		for(var i = 'A'.charCodeAt(0); i<='I'.charCodeAt(0);i++) {
			var type = String.fromCharCode(i);
			if(this.checkboxes[type].checked) {
				selected.push(type);
			}
		}		
		
		if(selected.length == 0) {
			// money is always acceptable
			selected.push('A');
		}
		return selected;
	}
	
	
	function TreasureBlock(div, overallTreasureBlock, treasureIndex) {
		this.div = div;
		this.overallTreasureBlock = overallTreasureBlock;
		this.treasureIndex = treasureIndex;
		
		this.generatedGold = [];
		this.generatedGems = [];
		this.generatedArt = [];
		this.generatedItems = [];
		this.generatedWeapons = [];
		this.generatedArmour = [];

		// the current state
		this.type = null;
		this.budget = 1000;
		this.allocation = null; // the currently selected allocation
		
		div.controller = this;
		this.typeSelector = document.createElement('select');

		for(var i = 'A'.charCodeAt(0); i<='I'.charCodeAt(0);i++) {
			var tt = String.fromCharCode(i);
			eee = document.createElement("option");
			eee.text = tt + " - " + treasureTypeLabels[tt];
			eee.value = tt;
			this.typeSelector.appendChild(eee);
		}
		
		div.appendChild(this.typeSelector);
		this.typeSelector.onchange = function(ev) {
			controller(this).setType(this.value)
		};
		
		this.budgetSelector = document.createElement('select');
		div.appendChild(this.budgetSelector);
		
		this.budgetSelector.onchange = function(ev) {
			controller(this).setAllocationIndex(parseInt(this.value))
		};

		var e
		e = document.createElement("button");
		e.innerHTML = "clear";
		e.onclick = function() {
			controller(this).clear();
		};
		div.appendChild(e);

		e = document.createElement("button");
		e.innerHTML = "reroll";
		e.onclick = function() {
			controller(this).reroll();
		};
		div.appendChild(e);

		e = document.createElement("button");
		e.innerHTML = "delete";
		e.onclick = function() {
			controller(this).delete();
		};
		div.appendChild(e);
		
		this.generatedSpan = document.createElement("span");
		div.appendChild(this.generatedSpan);
		
		this.setType('A');
		
	}
	
	TreasureBlock.prototype.toString = function() {
		return "TreasureBlock belonging to " + this.overallTreasureBlock;
	}
	
	TreasureBlock.prototype.clear = function() {
		// clear does not clear the selected combos - it clears the generated treasure.
		
		this.generatedGold.length = 0;
		this.generatedGems.length = 0;
		this.generatedArt.length = 0;
		this.generatedItems.length = 0;
		this.generatedWeapons.length = 0;
		this.generatedArmour.length = 0;
		
		clearElement(this.generatedSpan);
		this.overallTreasureBlock.calculateBudgetConsumed();	
	}
	
	TreasureBlock.prototype.delete = function() {
		for(var i = this.treasureIndex; i<this.overallTreasureBlock.treasuresCount-1; i++) {
			this.overallTreasureBlock.treasures[i] = this.overallTreasureBlock.treasures[i+1];
			this.overallTreasureBlock.treasures[i].treasureIndex = i;
		}
		this.overallTreasureBlock.treasuresCount --;
		
		var tt = this.overallTreasureBlock.treasuresArea;
		clearElement(tt);
		
		for(var i = 0; i<this.overallTreasureBlock.treasuresCount; i++) {
			tt.appendChild(this.overallTreasureBlock.treasures[i].div);
		}
		
		this.overallTreasureBlock.calculateBudgetConsumed();	
	}
	
	TreasureBlock.prototype.getValue = function() {
		return this.allocation == null ? 0 : this.allocation.budget;
	}
	
	TreasureBlock.prototype.setType = function(type) {
		this.clear();

		clearElement(this.budgetSelector);
		
		if(type == null) return;
		
		// poplate the budget selector combo
		
		var allocationV = treasureTypeAllocations[type];
		if(!allocationV) return;
		
		for(var i = 0; i<allocationV.length; i++) {
			eee = document.createElement("option");
			eee.value = i;
			eee.text = allocationV[i].budget;
			this.budgetSelector.appendChild(eee);
		}
		
		this.setAllocationIndex(0);
	}
	
	TreasureBlock.prototype.setAllocationIndex = function(index) {
		var allocationV = treasureTypeAllocations[this.typeSelector.value];
		if(!allocationV) {
			this.setAllocation(null); 
		}
		else {
			this.setAllocation(allocationV[index]);
		}
	}
	
	TreasureBlock.prototype.setAllocation = function(allocation) {
		this.allocation = allocation;
		this.reroll();
	}
	
	TreasureBlock.prototype.reroll = function() {
		this.clear();
		
		if(this.allocation) {
			this.allocation.reroll(this);
		}
		
		// reroll based on the TreasureTypeSelector belonging to my overallTreasureBlock
		// if there is 
		this.overallTreasureBlock.calculateBudgetConsumed();	
	}
	
	
	// this class holds one cell of table 7-, 7-5 etc. It knows what type it is, how much it is worth, 
	// and how to generate a lump of loot.
	
	function TreasureTypeAllocation(type, budget, items) {
		this.type = type;
		this.budget = budget;
		this.items = items;
	}
	
	TreasureTypeAllocation.prototype.toString = function() {
		return "Treasure type " + this.type + " worth " + this.budget + "gp";
	}
	
	TreasureTypeAllocation.prototype.describeItems = function() {
		return this.items.toString();
	}
	
	TreasureTypeAllocation.prototype.reroll = function(treasureBlock) {
		for(var i = 0; i<this.items.length; i++) {
			if(this.items[i].reroll) {
				this.items[i].reroll(treasureBlock)
			}
			else {
				result = this.items[i].toString();
				treasureBlock.generatedItems.push(result);
				var sp = document.createElement('span');
				sp.style.margin = '1px';
				sp.style.padding = '1px';
				sp.style.border = 'thin solid darkgray';
				sp.appendChild(document.createTextNode(result));
				treasureBlock.generatedSpan.appendChild(sp);
			}
			if(i+1 < this.items.length) treasureBlock.generatedSpan.appendChild(document.createTextNode('; '));
		}
	}
	
	// this global constant holds the known allocations. The arrays are sorted in ascending order of gold, so
	// to find a treasure of type X worth not more than Y, go to the appropriate letter and scan backwards
	
	var treasureTypeAllocations = new Object();

	function CoinDenomination(lbl, cp) {
		this.lbl = lbl;
		this.cp = cp;
	}
	
	CoinDenomination.prototype.toString = function() { return this.lbl;}
	
	var cp = new CoinDenomination('cp', 1);
	var sp = new CoinDenomination('sp', 10);
	var gp = new CoinDenomination('gp', 100);
	var pp = new CoinDenomination('pp', 1000);
	

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	// plain string is a placeholder class, allowing us to 	   
	// build the meta-classes

	function plainString(s) {
		return new PlainString(s)
	}
	
	function PlainString(s) {
		this.s = s;
	}
	                         	
	PlainString.prototype.toString = function() {
		return this.s;
	}

	PlainString.prototype.reroll = function(treasureBlock) {
		treasureBlock.generatedItems.push(this.s)
		treasureBlock.generatedSpan.appendChild(document.createTextNode(this.s));
	}
	
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	// I may not know much about it, but I know what I like

    var artTypeTable = [
                     null,
                     new D100Picker([]),
                     new D100Picker([]),
                     new D100Picker([]),
                     new D100Picker([]),
                     new D100Picker([]),
                     new D100Picker([])
    ];

	function ArtObject(lbl, amt) {
		this.lbl = lbl;
		this.amt = amt;
	}
	
	ArtObject.prototype.toString = function() {
		return this.lbl + " ("+this.amt+"gp)";
	}

	function artPicker(grade) {
		return new ArtPicker(grade);
	}
	
	function ArtPicker(grade) {
		this.grade = grade;
	}
	
	ArtPicker.prototype.reroll = function(treasureBlock) {
		var result = new ArtResult(this.grade);
		treasureBlock.generatedArt.push(result)
		treasureBlock.generatedSpan.appendChild(document.createTextNode(result));
	}
	
	function ArtResult(grade) {
		this.grade = grade;
		// there is space here to add multipliers for 'very good' or 'crappy' art
		this.artObject = artTypeTable[grade].gen().generated
	}
	
	ArtResult.prototype.toString = function() {
		return this.artObject.toString();
	}

	ArtResult.prototype.getValue = function() {
		return this.artObject.amt;
	}

	artTypeTable[1].add(1,100,new ArtObject('grade 1 art object', 50))
	artTypeTable[2].add(1,100,new ArtObject('grade 2 art object', 100))
	artTypeTable[3].add(1,100,new ArtObject('grade 3 art object', 500))
	artTypeTable[4].add(1,100,new ArtObject('grade 4 art object', 1000))
	artTypeTable[5].add(1,100,new ArtObject('grade 5 art object', 5000))
	artTypeTable[6].add(1,100,new ArtObject('grade 6 art object', 10000))
	


picker = artTypeTable[1];
picker.add(1, 5, new ArtObject('Bronze statuette of a warrior', 15));
picker.add(6, 6, new ArtObject('Elaborate copper wind chimes', 20));
picker.add(7, 7, new ArtObject('Painted paper fan with silver slats', 20));
picker.add(8, 9, new ArtObject('Copper and glass decanter', 25));
picker.add(10, 17, new ArtObject('Silver holy symbol', 25));
picker.add(18, 21, new ArtObject('Carved stone idol', 30));
picker.add(22, 25, new ArtObject('Set of six ivory dice', 30));
picker.add(26, 29, new ArtObject('Ivory bowl with animal carvings', 40));
picker.add(30, 30, new ArtObject('Porcelain doll with silk clothing', 40));
picker.add(31, 32, new ArtObject('Porcelain mask', 40));
picker.add(33, 36, new ArtObject('Bronze flagon with warrior images', 50));
picker.add(37, 39, new ArtObject('Copper brazier with religious markings', 50));
picker.add(40, 42, new ArtObject('Copper scepter with gold inlay', 50));
picker.add(43, 44, new ArtObject('Crystal egg with silver stand', 50));
picker.add(45, 46, new ArtObject('Painting of a noblewoman', 50));
picker.add(47, 51, new ArtObject('Polished darkwood chalice', 50));
picker.add(52, 52, new ArtObject('Silver baby rattle', 50));
picker.add(53, 55, new ArtObject('Silver chess set', 50));
picker.add(56, 60, new ArtObject('Carved ivory scroll case', 60));
picker.add(61, 66, new ArtObject('Decorated silver plate', 60));
picker.add(67, 71, new ArtObject('Ivory drinking horn with copper ends', 60));
picker.add(72, 74, new ArtObject('Silver noble family seal', 60));
picker.add(75, 80, new ArtObject('Silver statue of a dragon', 65));
picker.add(81, 83, new ArtObject('Electrum censer with silver filigree', 70));
picker.add(84, 87, new ArtObject('Silver candelabra with holy symbol', 75));
picker.add(88, 90, new ArtObject('Silver comb with ornate handle', 75));
picker.add(91, 93, new ArtObject('Silver hand mirror', 75));
picker.add(94, 96, new ArtObject('Crystal skull', 80));
picker.add(97, 97, new ArtObject('Ornate silver flute', 80));
picker.add(98, 100, new ArtObject('Engraved jade scarab', 85));

picker = artTypeTable[2];
picker.add(1, 2, new ArtObject('Elaborate silver wind chimes', 60));
picker.add(3, 8, new ArtObject('Engraved gold scarab', 75));
picker.add(9, 10, new ArtObject('Painted silk fan with electrum slats', 75));
picker.add(11, 12, new ArtObject('Preserved beast head on a plaque', 75));
picker.add(13, 17, new ArtObject('Set of six silver dice', 75));
picker.add(18, 20, new ArtObject('Silver and glass decanter', 75));
picker.add(21, 22, new ArtObject('Silver bowl with lion engravings', 75));
picker.add(23, 26, new ArtObject('Silver mask', 75));
picker.add(27, 30, new ArtObject('Carved jade idol', 80));
picker.add(31, 31, new ArtObject('Porcelain doll with furs and jewelry', 80));
picker.add(32, 35, new ArtObject('Silver brazier with religious markings', 80));
picker.add(36, 38, new ArtObject('Silver flagon with religious markings', 80));
picker.add(39, 41, new ArtObject('Gold censer with silver filigree', 90));
picker.add(42, 44, new ArtObject('Gold and silver chess set', 100));
picker.add(45, 45, new ArtObject('Gold baby rattle', 100));
picker.add(46, 53, new ArtObject('Gold holy symbol', 100));
picker.add(54, 56, new ArtObject('Masterwork lyre', 100));
picker.add(57, 58, new ArtObject('Painting of a princess', 100));
picker.add(59, 61, new ArtObject('Silver cup with royal crest', 100));
picker.add(62, 65, new ArtObject('Decorated electrum plate', 110));
picker.add(66, 69, new ArtObject('Gold statue of a dragon', 110));
picker.add(70, 72, new ArtObject('Gold statue of a lion', 110));
picker.add(73, 77, new ArtObject('Ivory drinking horn with silver ends', 110));
picker.add(78, 81, new ArtObject('Gold and silver hand mirror', 120));
picker.add(82, 85, new ArtObject('Silver cauldron with animal symbols', 120));
picker.add(86, 88, new ArtObject('Silver comb with gold handle', 125));
picker.add(89, 90, new ArtObject('Silver egg with dragon figurine', 125));
picker.add(91, 92, new ArtObject('Silver scepter with eagle symbols', 125));
picker.add(93, 97, new ArtObject('Silver chalice with dragon carvings', 150));
picker.add(98, 100, new ArtObject('Gold candelabra with holy symbol', 200));

picker = artTypeTable[3];
picker.add(1, 3, new ArtObject('Gilded demon skull', 300));
picker.add(4, 13, new ArtObject('Marble idol', 300));
picker.add(14, 19, new ArtObject('Masterwork darkwood lute', 300));
picker.add(20, 24, new ArtObject('Engraved mithral scarab', 400));
picker.add(25, 28, new ArtObject('Gold and ivory decanter', 400));
picker.add(29, 32, new ArtObject('Gold bowl with dragon engravings', 400));
picker.add(33, 35, new ArtObject('Gold censer with platinum inlay', 400));
picker.add(36, 41, new ArtObject('Gold mask', 450));
picker.add(42, 42, new ArtObject('Gold and mithral baby rattle', 500));
picker.add(43, 48, new ArtObject('Gold chess set', 500));
picker.add(49, 51, new ArtObject('Gold flagon with religious markings', 500));
picker.add(52, 56, new ArtObject('Gold puzzle box', 500));
picker.add(57, 65, new ArtObject('Platinum holy symbol', 500));
picker.add(66, 69, new ArtObject('Gold cup with royal crest', 550));
picker.add(70, 77, new ArtObject('Gold chalice with griffon carvings', 600));
picker.add(78, 81, new ArtObject('Mithral scepter with gold inlay', 600));
picker.add(82, 88, new ArtObject('Decorated gold plate', 700));
picker.add(89, 93, new ArtObject('Gold and platinum statuette of a deity', 750));
picker.add(94, 96, new ArtObject('Gold cauldron with alchemical symbols', 750));
picker.add(97, 100, new ArtObject('Painting of a queen', 750));

picker = artTypeTable[4];
picker.add(1, 5, new ArtObject('Engraved platinum scarab', 700));
picker.add(6, 11, new ArtObject('Gilded dragon skull', 800));
picker.add(12, 18, new ArtObject('Platinum bowl with arcane engravings', 800));
picker.add(19, 22, new ArtObject('Platinum censer with ornate markings', 800));
picker.add(23, 26, new ArtObject('Gold decanter with grape vine patterns', 850));
picker.add(27, 31, new ArtObject('Platinum mask', 900));
picker.add(32, 36, new ArtObject('Gold and mithral chess set', 1000));
picker.add(37, 41, new ArtObject('Gold and platinum orrery', 1000));
picker.add(42, 46, new ArtObject('Gold flute', 1000));
picker.add(47, 51, new ArtObject('Gold idol with strange carvings', 1000));
picker.add(52, 52, new ArtObject('Platinum baby rattle', 1000));
picker.add(53, 55, new ArtObject('Platinum holy symbol of a famous priest', 1000));
picker.add(56, 64, new ArtObject('Decorated platinum plate', 1100));
picker.add(65, 68, new ArtObject('Platinum cauldron with odd symbols', 1100));
picker.add(69, 71, new ArtObject('Platinum flagon with religious markings', 1100));
picker.add(72, 77, new ArtObject('Platinum cup with royal crest', 1200));
picker.add(78, 81, new ArtObject('Platinum scepter with gold inlay', 1200));
picker.add(82, 87, new ArtObject('Platinum chalice with angel carvings', 1250));
picker.add(88, 93, new ArtObject('Platinum statuette of a deity', 1300));
picker.add(94, 100, new ArtObject('Painting of a queen by a master', 1500));

picker = artTypeTable[5];
picker.add(1, 8, new ArtObject('Book of lost songs by a famous bard', 3000));
picker.add(9, 16, new ArtObject('Darkwood and platinum music box', 4000));
picker.add(17, 26, new ArtObject('Mithral hourglass with diamond dust', 4000));
picker.add(27, 34, new ArtObject('Jeweled egg with epic sorcerer’s blood', 4500));
picker.add(35, 37, new ArtObject('Gold urn containing hero’s ashes', 5000));
picker.add(38, 45, new ArtObject('Helm carved from a pit fiend skull', 5000));
picker.add(46, 55, new ArtObject('Holy text penned by a saint', 5000));
picker.add(56, 65, new ArtObject('Painting of a beloved queen by a master', 5000));
picker.add(66, 74, new ArtObject('Platinum idol with mysterious markings', 5000));
picker.add(75, 77, new ArtObject('Bejeweled sword of state', 6000));
picker.add(78, 83, new ArtObject('Carved saint’s femur', 6000));
picker.add(84, 88, new ArtObject('Platinum chalice blessed by a saint', 6000));
picker.add(89, 91, new ArtObject('Glowing metallic meteor', 6500));
picker.add(92, 97, new ArtObject('Gold bejeweled royal orb', 7000));
picker.add(98, 100, new ArtObject('Crystallized dragon heart', 7500));

picker = artTypeTable[6];
picker.add(1, 6, new ArtObject('Frozen vampire soul', 7000));
picker.add(7, 13, new ArtObject('Mithral-inlaid unicorn horn', 7000));
picker.add(14, 16, new ArtObject('Crystallized god breath', 10000));
picker.add(17, 22, new ArtObject('Essence of truth', 10000));
picker.add(23, 31, new ArtObject('Globe of pristine air', 10000));
picker.add(32, 40, new ArtObject('Heart of the mountain', 10000));
picker.add(41, 46, new ArtObject('Inverted soul gem', 10000));
picker.add(47, 55, new ArtObject('Orb of living water', 10000));
picker.add(56, 64, new ArtObject('Shard of pure fire', 10000));
picker.add(65, 72, new ArtObject('Unmelting ice', 10000));
picker.add(73, 79, new ArtObject('Time jewel', 11000));
picker.add(80, 83, new ArtObject('Adamantine poiuyt', 12000));
picker.add(84, 89, new ArtObject('Holy text written in saint’s blood', 12000));
picker.add(90, 93, new ArtObject('Mithral tribar', 12000));
picker.add(94, 100, new ArtObject('Ethereal tapestry', 13000));
	
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                 	
    var gemTypeTable = [
                     null,
                     new D100Picker([]),
                     new D100Picker([]),
                     new D100Picker([]),
                     new D100Picker([]),
                     new D100Picker([]),
                     new D100Picker([])
    ];
    
    //bulletproofing
    for(var i = 1; i<=6;i++) {
    	gemTypeTable[i].add(1,100,'grade ' + i + ' gem');
    }
  
    picker = gemTypeTable[1];
    picker.add(1,8,'Agate');
    picker.add(9,14,'Alabaster');
    picker.add(14,20,'Azurite');
    picker.add(21,26,'Hematite');
    picker.add(27,34,'Lapis lazuli');
    picker.add(35,40,'Malachite');
    picker.add(41,48,'Obsidian');
    picker.add(49,56,'Pearl, irregular freshwater');
    picker.add(57,62,'Pyrite');
    picker.add(63,70,'Rhodochrosite');
    picker.add(71,78,'Quartz, rock crystal');
    picker.add(79,84,'Shell');
    picker.add(85,92,'Tigereye');
    picker.add(93,100,'Turquoise');

    picker = gemTypeTable[2];
    picker.add(1,6,'Bloodstone');
    picker.add(7,12,'Carnelian');
    picker.add(13,18,'Chrysoprase');
    picker.add(19,24,'Citrine');
    picker.add(25,32,'Ivory');
    picker.add(33,38,'Jasper');
    picker.add(39,44,'Moonstone');
    picker.add(45,50,'Onyx');
    picker.add(51,56,'Peridot');
    picker.add(57,74,'Quartz, milky, rose, or smoky');
    picker.add(75,80,'Sard');
    picker.add(81,86,'Sardonyx');
    picker.add(87,92,'Spinel, red or green');
    picker.add(94,100,'Zircon');

    picker = gemTypeTable[3];
    picker.add(1,10,'Amber');
    picker.add(11,20,'Amethyst');
    picker.add(21,30,'Chrysoberyl');
    picker.add(31,40,'Coral');
    picker.add(41,50,'Garnet');
    picker.add(51,60,'Jade');
    picker.add(61,70,'Jet');
    picker.add(71,80,'Pearl, saltwater');
    picker.add(81,90,'Spinel, deep blue');
    picker.add(91,100,'Tourmaline');

    picker = gemTypeTable[4];
    picker.add(1,25,'Aquamarine');
    picker.add(26,50,'Opal');
    picker.add(51,75,'Pearl, black');
    picker.add(76,100,'Topaz');

    picker = gemTypeTable[5];
    picker.add(1,25,'Diamond, small');
    picker.add(26,50,'Emerald');
    picker.add(51,75,'Ruby, small');
    picker.add(76,100,'Sapphire');

    picker = gemTypeTable[6];
    picker.add(1,25,'Diamond, large');
    picker.add(26,50,'Emerald, brilliant green');
    picker.add(51,75,'Ruby, large');
    picker.add(76,100,'Sapphire, star');
    
	function gemPicker(grade) {
		return new GemPicker(grade)
	}
	
	function GemPicker(grade) {
		this.grade = grade;
	}
	                         	
	GemPicker.prototype.toString = function() {
		return 'Grade ' + this.grade + ' gem';
	}

	GemPicker.prototype.reroll = function(treasureBlock) {
		var result = new GemResult(this.grade);
		treasureBlock.generatedGems.push(result)
		treasureBlock.generatedSpan.appendChild(document.createTextNode(result));
	}

	function GemValueRoller(base, n,d,mul) {
		this.base = base;
		this.n = n;
		this.d = d;
		this.mul=mul;
	}
	
	var gemValueRollers = [
	                       null,
	                       new GemValueRoller(5,2,4,1),
	                       new GemValueRoller(25,2,4,5),
	                       new GemValueRoller(50,2,4,10),
	                       new GemValueRoller(250,2,4,50),
	                       new GemValueRoller(500,2,4,100),
	                       new GemValueRoller(2500,2,4,500)
	                       ];
	
	GemValueRoller.prototype.getRoll = function() {
		return this.base + roll(this.n, this.d) * this.mul;	 
	}
	
	function GemResult(grade) {
		this.grade=grade;
		this.base=gemValueRollers[grade].getRoll();
		this.worked = (rnd(2) == 1);
		this.gemType = gemTypeTable[grade].gen().generated
	}
	
	GemResult.prototype.getValue = function() {
		return this.worked ? this.base : this.base/2;
	}

	GemResult.prototype.toString = function() {
		return this.gemType + " (" + (this.worked?'':'unworked ') + this.getValue() + "gp)";
	}
	
	
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	
	function mult(howmany, generator) {
		return new Multiple(howmany, generator);
	}
	
	function Multiple(howmany, generator) {
		this.howmany = howmany;
		this.generator = generator;
	}
	
	Multiple.prototype.toString = function() {
		return this.howmany + " * " + generator;
	}

	Multiple.prototype.reroll = function(treasureBlock) {
		for(var i = 0; i < this.howmany; i++) {
			this.generator.reroll(treasureBlock);			
			if(i+1<this.howmany) treasureBlock.generatedSpan.appendChild(document.createTextNode("; "));
		}
		
	}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	// this function builds a coin picker based on a parameter string
	function makeCoinPicker(n, d, mul, denom) {
		return new CoinPicker(n, d, mul, denom);
	}
	
	function CoinPicker(n, d, mul, denom) {
		this.roller = new DiceRoller(n, d, 0)
		this.mul = mul;
		this.denom = denom;
	}
	
	CoinPicker.prototype.toString = function() {
		return this.roller + '×' + (this.mul==1?'':this.mul) + this.denom;
	}

	CoinPicker.prototype.reroll = function(treasureBlock) {
		var result = new CoinPickerResult(this, this.roller.gen());
		treasureBlock.generatedGold.push(result)
		treasureBlock.generatedSpan.appendChild(document.createTextNode(result));
	}
	
	function CoinPickerResult(picker, roll) {
		this.picker = picker;
		this.roll = roll;
	}

	CoinPickerResult.prototype.toString = function() {
		return (this.picker.mul*this.roll.amt) + this.picker.denom.lbl;
	}
	
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


	treasureTypeAllocations.A = [
	new TreasureTypeAllocation('A',     1, [makeCoinPicker(5, 10, 1, cp), makeCoinPicker(3, 4, 1, sp)]),
	new TreasureTypeAllocation('A',     5, [makeCoinPicker(2, 6, 10, cp), makeCoinPicker(4, 8, 1, sp), makeCoinPicker(1, 4, 1, gp)]),
	new TreasureTypeAllocation('A',    10, [makeCoinPicker(5, 10, 10, cp), makeCoinPicker(5, 10, 1, sp), makeCoinPicker(1, 8, 1, gp)]),
	new TreasureTypeAllocation('A',    25, [makeCoinPicker(2, 4, 100, cp), makeCoinPicker(3, 6, 10, sp), makeCoinPicker(4, 4, 1, gp)]),
	new TreasureTypeAllocation('A',    50, [makeCoinPicker(4, 4, 100, cp), makeCoinPicker(4, 6, 10, sp), makeCoinPicker(8, 6, 1, gp)]),
	new TreasureTypeAllocation('A',   100, [makeCoinPicker(6, 8, 10, sp), makeCoinPicker(3, 4, 10, gp)]),
	new TreasureTypeAllocation('A',   200, [makeCoinPicker(2, 4, 100, sp), makeCoinPicker(4, 4, 10, gp), makeCoinPicker(2, 4, 1, pp)]),
	new TreasureTypeAllocation('A',   500, [makeCoinPicker(6, 6, 10, gp), makeCoinPicker(8, 6, 1, pp)]),
	new TreasureTypeAllocation('A',  1000, [makeCoinPicker(2, 4, 100, gp), makeCoinPicker(10, 10, 1, pp)]),
	new TreasureTypeAllocation('A',  5000, [makeCoinPicker(4, 8, 100, gp), makeCoinPicker(6, 10, 10, pp)]),
	new TreasureTypeAllocation('A', 10000, [makeCoinPicker(2, 4, 1000, gp), makeCoinPicker(12, 8, 10, pp)]),
	new TreasureTypeAllocation('A', 50000, [makeCoinPicker(2, 6, 1000, gp), makeCoinPicker(8, 10, 100, pp)])
	];
	
	treasureTypeAllocations.B = [
	new TreasureTypeAllocation('B',   10, [gemPicker(1)]),
	new TreasureTypeAllocation('B',   15, [makeCoinPicker(2, 6, 10, cp), makeCoinPicker(4, 8, 1, sp), makeCoinPicker(1, 4, 1, gp), gemPicker(1)]),
	new TreasureTypeAllocation('B',   25, [makeCoinPicker(5, 10, 1, sp), makeCoinPicker(1, 4, 1, gp), mult(2, gemPicker(1))]),
	new TreasureTypeAllocation('B',   50, [gemPicker(2)]),
	new TreasureTypeAllocation('B',   50, [makeCoinPicker(3, 6, 10, sp), makeCoinPicker(3, 6, 1, gp), mult(3, gemPicker(1))]),
	new TreasureTypeAllocation('B',   75, [makeCoinPicker(1, 4, 10, sp), makeCoinPicker(1, 4, 1, gp), mult(2, gemPicker(1)), gemPicker(2)]),
	new TreasureTypeAllocation('B',  100, [gemPicker(3)]),
	new TreasureTypeAllocation('B',  100, [makeCoinPicker(3, 8, 10, sp), makeCoinPicker(4, 8, 1, gp), mult(2, gemPicker(1)), gemPicker(2)]),
	new TreasureTypeAllocation('B',  150, [gemPicker(2), gemPicker(3)]),
	new TreasureTypeAllocation('B',  200, [makeCoinPicker(3, 6, 10, sp), plainString('2d4x10 gp'), mult(4, gemPicker(1)), gemPicker(3)]),
	new TreasureTypeAllocation('B',  250, [makeCoinPicker(2, 4, 10, gp), mult(2, gemPicker(2)), gemPicker(3)]),
	new TreasureTypeAllocation('B',  500, [gemPicker(4)]),
	new TreasureTypeAllocation('B',  500, [makeCoinPicker(2, 4, 10, gp), makeCoinPicker(2, 4, 1, pp), mult(2, gemPicker(2)), mult(3, gemPicker(3))]),
	new TreasureTypeAllocation('B',  750, [makeCoinPicker(2, 4, 10, gp), mult(3, gemPicker(2)), gemPicker(3), gemPicker(4)]),
	new TreasureTypeAllocation('B', 1000, [gemPicker(5)]),
	new TreasureTypeAllocation('B', 1000, [makeCoinPicker(3, 6, 10, gp), makeCoinPicker(4, 4, 1, pp), mult(3, gemPicker(3)), gemPicker(4)]),
	new TreasureTypeAllocation('B', 2500, [makeCoinPicker(2, 4, 100, gp), mult(2, gemPicker(4)), gemPicker(5)]),
	new TreasureTypeAllocation('B', 5000, [gemPicker(6)]),
	new TreasureTypeAllocation('B', 5000, [makeCoinPicker(2, 4, 100, gp), plainString('2d4x10 pp'), mult(2, gemPicker(4)), mult(3, gemPicker(5))]),
	new TreasureTypeAllocation('B',10000, [mult(5, gemPicker(5)), gemPicker(6)]),
	new TreasureTypeAllocation('B',20000, [makeCoinPicker(4, 8, 100, gp), plainString('6d10x10 pp'), mult(3, gemPicker(6))]),
	new TreasureTypeAllocation('B',50000, [makeCoinPicker(4, 4, 10, pp), mult(10, gemPicker(3)), mult(4, gemPicker(4)), mult(6, gemPicker(5)), mult(8, gemPicker(6))])
	];
	

	treasureTypeAllocations.C = [
	new TreasureTypeAllocation('C', 50, [artPicker(1)]),
	new TreasureTypeAllocation('C', 100, [artPicker(2)]),
	new TreasureTypeAllocation('C', 100, [mult(2, artPicker(1))]),
	new TreasureTypeAllocation('C', 150, [artPicker(1), artPicker(2)]),
	new TreasureTypeAllocation('C', 200, [mult(2, artPicker(2))]),
	new TreasureTypeAllocation('C', 250, [mult(3, artPicker(1)), artPicker(2)]),
	new TreasureTypeAllocation('C', 500, [artPicker(3)]),
	new TreasureTypeAllocation('C', 500, [mult(4, artPicker(1)), mult(3, artPicker(2))]),
	new TreasureTypeAllocation('C', 750, [mult(3, artPicker(1)), mult(2, artPicker(2)), artPicker(3)]),
	new TreasureTypeAllocation('C', 1000, [artPicker(4)]),
	new TreasureTypeAllocation('C', 1000, [mult(2, artPicker(3))]),
	new TreasureTypeAllocation('C', 1500, [artPicker(3), artPicker(4)]),
	new TreasureTypeAllocation('C', 2000, [mult(2, artPicker(4))]),
	new TreasureTypeAllocation('C', 2500, [mult(5, artPicker(2)), mult(2, artPicker(3)), artPicker(4)]),
	new TreasureTypeAllocation('C', 5000, [artPicker(5)]),
	new TreasureTypeAllocation('C', 5000, [mult(4, artPicker(3)), mult(3, artPicker(4))]),
	new TreasureTypeAllocation('C', 7500, [artPicker(3), mult(2, artPicker(4)), artPicker(5)]),
	new TreasureTypeAllocation('C', 10000, [artPicker(6)]),
	new TreasureTypeAllocation('C', 10000, [mult(5, artPicker(4)), artPicker(5)]),
	new TreasureTypeAllocation('C', 15000, [artPicker(5), artPicker(6)]),
	new TreasureTypeAllocation('C', 20000, [mult(2, artPicker(5)), artPicker(6)]),
	new TreasureTypeAllocation('C', 50000, [mult(10, artPicker(3)), mult(5, artPicker(4)), mult(4, artPicker(5)), mult(2, artPicker(6))])
	];

	treasureTypeAllocations.D = [
	new TreasureTypeAllocation('D', 50, [makeCoinPicker(3, 6, 10, sp), makeCoinPicker(4, 4, 1, gp), plainString('lesser minor scroll')]),
	new TreasureTypeAllocation('D', 50, [makeCoinPicker(2, 4, 10, sp), makeCoinPicker(2, 4, 1, gp), plainString('lesser minor potion')]),
	new TreasureTypeAllocation('D', 100, [makeCoinPicker(4, 6, 10, sp), makeCoinPicker(3, 10, 1, gp), plainString('lesser minor potion'), plainString('lesser minor scroll')]),
	new TreasureTypeAllocation('D', 150, [makeCoinPicker(2, 4, 10, sp), makeCoinPicker(6, 6, 1, gp), plainString('greater minor scroll')]),
	new TreasureTypeAllocation('D', 200, [makeCoinPicker(2, 4, 10, sp), makeCoinPicker(4, 6, 1, gp), plainString('greater minor potion'), plainString('lesser minor scroll')]),
	new TreasureTypeAllocation('D', 250, [makeCoinPicker(3, 6, 10, sp), makeCoinPicker(3, 6, 1, gp), makeCoinPicker(1, 4, 1, pp), mult(2, plainString('lesser minor potions')), plainString('greater minor scroll')]),
	new TreasureTypeAllocation('D', 300, [makeCoinPicker(2, 4, 10, sp), makeCoinPicker(6, 6, 1, gp), plainString('greater minor potion'), plainString('greater minor scroll')]),
	new TreasureTypeAllocation('D', 400, [plainString('Greater minor potion'), mult(2, plainString('greater minor scrolls'))]),
	new TreasureTypeAllocation('D', 500, [makeCoinPicker(2, 4, 10, gp), makeCoinPicker(1, 4, 1, pp), plainString('lesser medium potion'), plainString('greater minor scroll')]),
	new TreasureTypeAllocation('D', 500, [makeCoinPicker(2, 4, 10, gp), makeCoinPicker(1, 4, 1, pp), mult(2, plainString('greater minor potions')), plainString('greater minor scroll')]),
	new TreasureTypeAllocation('D', 750, [makeCoinPicker(7, 6, 1, gp), plainString('greater minor scroll'), plainString('lesser minor wand')]),
	new TreasureTypeAllocation('D', 1000, [makeCoinPicker(4, 4, 10, gp), makeCoinPicker(3, 6, 1, pp), plainString('lesser medium potion'), plainString('lesser medium scroll')]),
	new TreasureTypeAllocation('D', 1000, [makeCoinPicker(2, 4, 10, gp), makeCoinPicker(2, 4, 1, pp), plainString('lesser medium potion'), plainString('lesser minor wand')]),
	new TreasureTypeAllocation('D', 1500, [plainString('Greater minor wand')]),
	new TreasureTypeAllocation('D', 1500, [makeCoinPicker(4, 4, 10, gp), makeCoinPicker(3, 6, 1, pp), plainString('greater medium potion'), plainString('greater medium scroll')]),
	new TreasureTypeAllocation('D', 2000, [plainString('Greater medium potion'), plainString('greater minor wand')]),
	new TreasureTypeAllocation('D', 2000, [makeCoinPicker(2, 4, 10, gp), makeCoinPicker(2, 4, 1, pp), plainString('lesser medium potion'), mult(2, plainString('greater medium scrolls'))]),
	new TreasureTypeAllocation('D', 3000, [makeCoinPicker(3, 6, 10, gp), makeCoinPicker(4, 4, 1, pp), plainString('greater medium potion'), plainString('greater medium scroll'), plainString('greater minor wand')]),
	new TreasureTypeAllocation('D', 4000, [makeCoinPicker(3, 6, 10, gp), makeCoinPicker(4, 4, 1, pp), plainString('greater medium scroll'), mult(2, plainString('greater minor wands'))]),
	new TreasureTypeAllocation('D', 5000, [makeCoinPicker(2, 4, 10, gp), makeCoinPicker(2, 4, 1, pp), mult(3, plainString('lesser major potions')), mult(2, plainString('greater medium scrolls')), plainString('greater minor wand ')]),
	new TreasureTypeAllocation('D', 7500, [makeCoinPicker(2, 6, 1, pp), plainString('lesser major scroll'), plainString('lesser medium wand')]),
	new TreasureTypeAllocation('D', 7500, [makeCoinPicker(5, 6, 1, pp), mult(2, plainString('greater major potions')), mult(2, plainString('greater major scrolls'))]),
	new TreasureTypeAllocation('D', 10000, [plainString('Greater medium wand')]),
	new TreasureTypeAllocation('D', 10000, [makeCoinPicker(4, 6, 1, pp), plainString('greater major potion'), plainString('greater major scroll'), plainString('lesser medium wand')]),
	new TreasureTypeAllocation('D', 15000, [plainString('Lesser major wand')]),
	new TreasureTypeAllocation('D', 15000, [makeCoinPicker(9, 10, 1, pp), mult(3, plainString('greater major potions')), mult(2, plainString('lesser major scrolls')), plainString('greater medium wand')]),
	new TreasureTypeAllocation('D', 20000, [makeCoinPicker(4, 4, 10, gp), plainString('2d4x10 pp'), mult(2, plainString('greater major potions')), plainString('greater major scroll'), plainString('lesser major wand')]),
	new TreasureTypeAllocation('D', 20000, [makeCoinPicker(6, 6, 10, gp), mult(3, plainString('lesser major potions')), plainString('greater major wand')]),
	new TreasureTypeAllocation('D', 25000, [mult(5, plainString('greater major scrolls')), plainString('greater medium wand')]),
	new TreasureTypeAllocation('D', 30000, [makeCoinPicker(6, 6, 1, pp), mult(4, plainString('greater major potions')), mult(3, plainString('greater major scrolls')), plainString('greater major wand')]),
	new TreasureTypeAllocation('D', 50000, [makeCoinPicker(8, 4, 10, pp), mult(4, plainString('greater major scrolls')), mult(2, plainString('greater major wands'))])
	];

	treasureTypeAllocations.E = [
	new TreasureTypeAllocation('E', 200, [plainString('Masterwork light armor or shield')]),
	new TreasureTypeAllocation('E', 300, [plainString('Masterwork medium armor')]),
	new TreasureTypeAllocation('E', 350, [plainString('Masterwork weapon')]),
	new TreasureTypeAllocation('E', 1000, [plainString('Masterwork heavy armor')]),
	new TreasureTypeAllocation('E', 1500, [plainString('Lesser minor armor')]),
	new TreasureTypeAllocation('E', 2500, [plainString('Lesser minor weapon')]),
	new TreasureTypeAllocation('E', 3000, [plainString('Greater minor armor')]),
	new TreasureTypeAllocation('E', 3000, [plainString('Masterwork medium armor'), plainString('masterwork shield'), plainString('lesser minor weapon')]),
	new TreasureTypeAllocation('E', 4000, [plainString('Lesser minor armor'), plainString('lesser minor weapon')]),
	new TreasureTypeAllocation('E', 5500, [plainString('Greater minor armor'), plainString('lesser minor weapon')]),
	new TreasureTypeAllocation('E', 6000, [plainString('Greater minor weapon')]),
	new TreasureTypeAllocation('E', 7500, [plainString('Lesser minor armor'), plainString('greater minor weapon')]),
	new TreasureTypeAllocation('E', 8000, [plainString('Greater minor armor'), mult(2, plainString('lesser minor weapons'))]),
	new TreasureTypeAllocation('E', 9000, [plainString('Greater minor armor'), plainString('greater minor weapon')]),
	new TreasureTypeAllocation('E', 10000, [plainString('Lesser medium armor'), plainString('lesser minor weapon')]),
	new TreasureTypeAllocation('E', 13000, [plainString('Lesser medium weapon')]),
	new TreasureTypeAllocation('E', 13000, [plainString('Lesser medium armor'), plainString('greater minor weapon')]),
	new TreasureTypeAllocation('E', 15000, [plainString('Greater medium armor'), plainString('lesser minor weapon')]),
	new TreasureTypeAllocation('E', 20000, [plainString('Lesser medium armor'), plainString('lesser medium weapon')]),
	new TreasureTypeAllocation('E', 25000, [plainString('Greater minor armor'), plainString('greater medium weapon')]),
	new TreasureTypeAllocation('E', 30000, [plainString('Lesser major armor'), plainString('lesser minor weapon'), plainString('greater minor weapon')]),
	new TreasureTypeAllocation('E', 30000, [plainString('Lesser medium armor'), plainString('greater medium weapon')]),
	new TreasureTypeAllocation('E', 35000, [plainString('Lesser major armor'), plainString('lesser medium weapon')]),
	new TreasureTypeAllocation('E', 35000, [plainString('Lesser minor armor'), plainString('lesser major weapon')]),
	new TreasureTypeAllocation('E', 40000, [plainString('Greater major armor'), plainString('greater minor weapon')]),
	new TreasureTypeAllocation('E', 50000, [plainString('Greater major armor'), plainString('lesser medium weapon')]),
	new TreasureTypeAllocation('E', 75000, [plainString('Greater minor armor'), plainString('greater major weapon')]),
	new TreasureTypeAllocation('E', 100000, [plainString('Greater major armor'), plainString('greater major weapon')])
	];

	treasureTypeAllocations.F = [
	new TreasureTypeAllocation('F', 50, [makeCoinPicker(2, 4, 10, sp), makeCoinPicker(2, 4, 1, gp), plainString('lesser minor potion')]),
	new TreasureTypeAllocation('F', 250, [makeCoinPicker(2, 4, 10, sp), makeCoinPicker(2, 4, 1, gp), plainString('masterwork light armor or shield'), plainString('lesser minor potion')]),
	new TreasureTypeAllocation('F', 350, [makeCoinPicker(2, 4, 10, sp), makeCoinPicker(2, 4, 1, gp), plainString('masterwork medium armor'), plainString('lesser minor potion')]),
	new TreasureTypeAllocation('F', 400, [makeCoinPicker(2, 4, 10, sp), makeCoinPicker(2, 4, 1, gp), plainString('masterwork weapon'), plainString('lesser minor potion')]),
	new TreasureTypeAllocation('F', 500, [plainString('Masterwork weapon'), plainString('greater minor potion ')]),
	new TreasureTypeAllocation('F', 750, [makeCoinPicker(6, 6, 1, gp), plainString('masterwork medium armor'), plainString('masterwork weapon'), mult(2, plainString('lesser minor potions'))]),
	new TreasureTypeAllocation('F', 1000, [plainString('Masterwork heavy armor')]),
	new TreasureTypeAllocation('F', 1500, [plainString('Masterwork heavy armor'), plainString('masterwork weapon'), plainString('greater minor potion')]),
	new TreasureTypeAllocation('F', 2000, [plainString('Lesser minor armor'), plainString('masterwork weapon'), mult(2, plainString('greater minor potions'))]),
	new TreasureTypeAllocation('F', 3000, [plainString('Masterwork medium armor'), plainString('lesser minor weapon'), plainString('greater minor potion')]),
	new TreasureTypeAllocation('F', 4000, [plainString('Lesser minor armor'), plainString('masterwork weapon'), plainString('lesser minor wondrous item'), plainString('greater minor potion')]),
	new TreasureTypeAllocation('F', 5000, [plainString('Masterwork medium armor'), plainString('lesser minor weapon'), plainString('lesser minor wondrous item'), plainString('greater minor potion')]),
	new TreasureTypeAllocation('F', 6000, [plainString('Lesser minor armor'), plainString('lesser minor weapon'), plainString('lesser minor wondrous item')]),
	new TreasureTypeAllocation('F', 7500, [plainString('Greater minor armor'), plainString('lesser minor weapon'), plainString('lesser minor ring')]),
	new TreasureTypeAllocation('F', 10000, [plainString('Greater minor armor'), plainString('lesser minor weapon'), plainString('lesser minor ring'), plainString('lesser minor wondrous item'), mult(3, plainString('greater minor potions'))]),
	new TreasureTypeAllocation('F', 10000, [plainString('Greater minor armor'), plainString('greater minor weapon'), mult(2, plainString('greater medium potions'))]),
	new TreasureTypeAllocation('F', 12500, [plainString('Greater minor armor'), plainString('lesser minor weapon'), plainString('greater minor wondrous item'), mult(2, plainString('greater medium potions'))]),
	new TreasureTypeAllocation('F', 15000, [plainString('Greater minor armor'), plainString('greater minor weapon'), plainString('greater minor ring')]),
	new TreasureTypeAllocation('F', 20000, [plainString('Lesser medium armor'), plainString('greater minor weapon'), plainString('greater minor wondrous item'), mult(2, plainString('greater medium potions'))]),
	new TreasureTypeAllocation('F', 25000, [plainString('Lesser medium armor'), plainString('lesser medium weapon'), plainString('lesser minor ring'), plainString('lesser minor wondrous item'), mult(2, plainString('greater medium potions'))]),
	new TreasureTypeAllocation('F', 30000, [plainString('Lesser medium armor'), plainString('lesser medium weapon'), mult(2, plainString('lesser minor rings')), plainString('greater minor wondrous items')]),
	new TreasureTypeAllocation('F', 40000, [plainString('Lesser medium armor'), plainString('lesser medium weapon'), plainString('lesser medium ring'), plainString('greater minor wondrous item'), mult(2, plainString('greater medium potions'))]),
	new TreasureTypeAllocation('F', 50000, [plainString('Greater medium armor'), plainString('greater medium weapon'), plainString('lesser medium wondrous item'), mult(2, plainString('lesser major potions'))]),
	new TreasureTypeAllocation('F', 60000, [plainString('Greater medium armor'), plainString('greater medium weapon'), mult(2, plainString('greater minor rings')), mult(2, plainString('greater minor wondrous items'))]),
	new TreasureTypeAllocation('F', 75000, [plainString('Lesser major armor'), plainString('greater medium weapon'), plainString('greater minor ring'), plainString('greater medium wondrous item'), mult(3, plainString('greater major potions'))]),
	new TreasureTypeAllocation('F', 100000, [plainString('Lesser major armor'), plainString('lesser major weapon'), plainString('lesser medium ring'), plainString('greater minor ring'), mult(2, plainString('lesser medium wondrous items'))])
	];

	treasureTypeAllocations.G = [
	new TreasureTypeAllocation('G', 50, [makeCoinPicker(2, 4, 10, sp), makeCoinPicker(2, 4, 1, gp), plainString('lesser minor potion')]),
	new TreasureTypeAllocation('G', 75, [makeCoinPicker(2, 4, 1, gp), plainString('lesser minor potion'), plainString('lesser minor scroll')]),
	new TreasureTypeAllocation('G', 100, [plainString('Lesser minor potion'), mult(2, plainString('lesser minor scrolls'))]),
	new TreasureTypeAllocation('G', 150, [plainString('Lesser minor scroll'), plainString('greater minor scroll')]),
	new TreasureTypeAllocation('G', 200, [mult(2, plainString('lesser minor potions')), plainString('greater minor scroll')]),
	new TreasureTypeAllocation('G', 250, [mult(2, plainString('greater minor scrolls'))]),
	new TreasureTypeAllocation('G', 500, [mult(3, plainString('lesser minor potions')), mult(3, plainString('greater minor scrolls'))]),
	new TreasureTypeAllocation('G', 750, [plainString('Greater minor potion'), plainString('lesser minor wand')]),
	new TreasureTypeAllocation('G', 1000, [makeCoinPicker(7, 6, 1, gp), mult(3, plainString('greater minor scrolls')), plainString('lesser minor wand')]),
	new TreasureTypeAllocation('G', 1500, [makeCoinPicker(3, 6, 10, gp), plainString('Lesser medium potion'), plainString('lesser medium scroll'), plainString('lesser minor wand')]),
	new TreasureTypeAllocation('G', 2000, [makeCoinPicker(2, 4, 10, gp), plainString('masterwork weapon'), mult(2, plainString('lesser medium scrolls')), plainString('lesser minor wand')]),
	new TreasureTypeAllocation('G', 2500, [mult(2, plainString('greater medium potions')), plainString('greater minor wand')]),
	new TreasureTypeAllocation('G', 3000, [plainString('Greater medium potion'), mult(2, plainString('lesser medium scrolls')), plainString('greater minor wand')]),
	new TreasureTypeAllocation('G', 4000, [plainString('Lesser minor wondrous item'), plainString('greater medium potion'), plainString('greater minor wand')]),
	new TreasureTypeAllocation('G', 5000, [plainString('Lesser minor ring'), plainString('lesser minor wondrous item'), mult(2, plainString('lesser medium scrolls'))]),
	new TreasureTypeAllocation('G', 6000, [plainString('Lesser minor ring'), plainString('lesser minor wondrous item'), plainString('greater medium potion'), plainString('greater minor wand')]),
	new TreasureTypeAllocation('G', 7500, [mult(2, plainString('greater medium potions')), plainString('lesser minor scroll'), plainString('lesser medium wand ')]),
	new TreasureTypeAllocation('G', 10000, [plainString('Lesser minor ring'), plainString('lesser minor wondrous item'), plainString('lesser medium wand')]),
	new TreasureTypeAllocation('G', 12500, [plainString('Lesser minor ring'), plainString('greater minor wondrous item'), mult(2, plainString('greater medium scrolls')), mult(2, plainString('greater minor wands'))]),
	new TreasureTypeAllocation('G', 15000, [plainString('Lesser minor ring'), plainString('lesser medium rod'), plainString('lesser medium wand')]),
	new TreasureTypeAllocation('G', 20000, [plainString('Greater minor ring'), plainString('greater minor wondrous item'), plainString('greater medium potion'), mult(2, plainString('greater medium scrolls')), plainString('lesser medium wand')]),
	new TreasureTypeAllocation('G', 25000, [plainString('Lesser minor ring'), plainString('lesser medium wand'), plainString('greater medium wand'), plainString('greater minor wondrous item')]),
	new TreasureTypeAllocation('G', 30000, [plainString('Greater minor ring'), plainString('lesser medium wondrous item'), plainString('lesser major scroll'), plainString('greater medium wand')]),
	new TreasureTypeAllocation('G', 40000, [plainString('Lesser minor weapon'), plainString('lesser medium staff'), plainString('greater medium rod'), mult(2, plainString('lesser minor wondrous items')), plainString('lesser medium wand')]),
	new TreasureTypeAllocation('G', 50000, [plainString('Greater minor ring'), mult(2, plainString('lesser medium wondrous items')), plainString('lesser major potion'), mult(3, plainString('greater medium scrolls')), plainString('lesser major wand')]),
	new TreasureTypeAllocation('G', 60000, [plainString('Lesser medium staff'), plainString('greater medium rod'), plainString('greater medium wondrous item'), plainString('greater medium potion'), mult(2, plainString('lesser major scrolls')), plainString('lesser medium wand')]),
	new TreasureTypeAllocation('G', 75000, [plainString('Lesser minor weapon'), plainString('greater medium staff'), plainString('greater medium wondrous item'), mult(3, plainString('greater major scrolls')), plainString('greater major wand')]),
	new TreasureTypeAllocation('G', 100000, [plainString('Lesser major ring'), plainString('greater medium rod'), plainString('lesser major staff'), plainString('lesser major scroll'), plainString('greater medium wand')])
	];

	treasureTypeAllocations.H = [
	new TreasureTypeAllocation('H', 500, [makeCoinPicker(4, 4, 100, cp), makeCoinPicker(3, 6, 10, sp), makeCoinPicker(2, 4, 10, gp), plainString('masterwork weapon'), plainString('lesser minor potion'), plainString('lesser minor scroll'), gemPicker(2)]),
	new TreasureTypeAllocation('H', 1000, [makeCoinPicker(2, 4, 100, cp), makeCoinPicker(2, 6, 100, sp), makeCoinPicker(6, 6, 1, gp), plainString('greater minor potion'), plainString('greater minor scroll'), plainString('lesser minor wand'), mult(3, gemPicker(1))]),
	new TreasureTypeAllocation('H', 2500, [makeCoinPicker(3, 6, 10, sp), makeCoinPicker(2, 4, 1, gp), plainString('masterwork heavy armor'), plainString('masterwork weapon'), mult(2, plainString('lesser medium potions')), mult(2, plainString('greater minor scrolls')), gemPicker(2)]),
	new TreasureTypeAllocation('H', 5000, [makeCoinPicker(2, 4, 10, gp), makeCoinPicker(4, 6, 1, pp), plainString('masterwork weapon'), plainString('lesser minor ring'), plainString('greater medium potion'), plainString('lesser medium scroll'), plainString('greater minor wand')]),
	new TreasureTypeAllocation('H', 7500, [makeCoinPicker(4, 4, 10, gp), makeCoinPicker(6, 6, 1, pp), plainString('lesser minor weapon'), plainString('lesser minor wondrous item'), mult(2, plainString('greater medium potions')), plainString('greater minor wand'), mult(2, gemPicker(3))]),
	new TreasureTypeAllocation('H', 10000, [makeCoinPicker(4, 8, 10, gp), makeCoinPicker(6, 10, 1, pp), plainString('greater minor armor'), plainString('lesser minor ring'), plainString('lesser minor wondrous item'), plainString('lesser medium scroll'), plainString('greater minor wand'), gemPicker(4)]),
	new TreasureTypeAllocation('H', 15000, [makeCoinPicker(4, 4, 10, gp), makeCoinPicker(4, 4, 10, pp), plainString('greater minor armor'), plainString('lesser minor wondrous item'), mult(2, plainString('greater medium potions')), mult(2, plainString('greater medium scrolls')), plainString('lesser medium wand'), gemPicker(3)]),
	new TreasureTypeAllocation('H', 20000, [makeCoinPicker(2, 4, 10, pp), plainString('greater minor ring'), mult(2, plainString('lesser minor wondrous items')), mult(2, plainString('greater medium potions')), mult(2, plainString('lesser major scrolls')), plainString('lesser medium wand')]),
	new TreasureTypeAllocation('H', 25000, [makeCoinPicker(6, 10, 10, gp), makeCoinPicker(6, 6, 1, pp), plainString('lesser medium armor'), plainString('lesser minor weapon'), plainString('greater minor wondrous item'), mult(2, plainString('lesser major scrolls')), plainString('lesser medium wand'), gemPicker(4)]),
	new TreasureTypeAllocation('H', 30000, [makeCoinPicker(6, 6, 10, gp), makeCoinPicker(2, 4, 10, pp), plainString('greater minor weapon'), plainString('lesser medium wondrous item'), plainString('greater medium wand'), mult(3, gemPicker(3))]),
	new TreasureTypeAllocation('H', 40000, [makeCoinPicker(4, 4, 10, gp), makeCoinPicker(4, 4, 10, pp), plainString('lesser medium ring'), plainString('lesser medium rod'), mult(2, plainString('greater major potions')), mult(2, plainString('lesser major scrolls')), plainString('lesser major wand')]),
	new TreasureTypeAllocation('H', 50000, [makeCoinPicker(4, 4, 10, pp), plainString('greater medium armor'), plainString('lesser medium staff'), plainString('lesser medium wondrous item'), plainString('greater major scroll'), plainString('lesser medium wand'), gemPicker(5)]),
	new TreasureTypeAllocation('H', 75000, [makeCoinPicker(2, 8, 100, gp), makeCoinPicker(4, 4, 10, pp), plainString('greater minor weapon'), plainString('greater medium ring'), plainString('greater medium staff'), mult(3, plainString('greater major potions')), plainString('greater major scroll'), plainString('lesser major wand'), gemPicker(5)]),
	new TreasureTypeAllocation('H', 100000, [makeCoinPicker(8, 6, 100, gp), makeCoinPicker(4, 4, 10, pp), plainString('lesser major ring'), plainString('lesser major wondrous item'), mult(3, plainString('greater major potions')), plainString('greater major scroll'), plainString('lesser medium wand'), mult(2, gemPicker(5)), gemPicker(6)])
	];

	treasureTypeAllocations.I = [
	new TreasureTypeAllocation('I', 5000, [makeCoinPicker(4, 4, 1000, cp), makeCoinPicker(6, 6, 100, sp), makeCoinPicker(2, 4, 100, gp), makeCoinPicker(6, 6, 1, pp), plainString('lesser minor armor'), plainString('greater minor wand'), mult(5, gemPicker(3)), artPicker(3)]),
	new TreasureTypeAllocation('I', 10000, [makeCoinPicker(4, 4, 1000, cp), makeCoinPicker(6, 6, 100, sp), makeCoinPicker(2, 4, 100, gp), makeCoinPicker(6, 6, 1, pp), plainString('greater minor armor'), plainString('lesser minor weapon'), plainString('lesser minor wondrous item'), plainString('greater medium scroll'), gemPicker(4), artPicker(3)]),
	new TreasureTypeAllocation('I', 15000, [makeCoinPicker(2, 4, 1000, cp), makeCoinPicker(6, 4, 100, sp), makeCoinPicker(3, 6, 10, gp), makeCoinPicker(6, 6, 1, pp), plainString('greater minor ring'), mult(2, plainString('lesser minor wondrous items')), mult(2, plainString('greater medium potions')), plainString('greater minor wand'), gemPicker(4), artPicker(3)]),
	new TreasureTypeAllocation('I', 20000, [makeCoinPicker(2, 4, 1000, cp), makeCoinPicker(6, 4, 100, sp), makeCoinPicker(3, 6, 10, gp), makeCoinPicker(6, 6, 1, pp), plainString('greater minor armor'), plainString('lesser medium rod'), plainString('greater minor wondrous item'), mult(2, plainString('lesser major potions')), plainString('greater medium scroll'), mult(3, artPicker(3))]),
	new TreasureTypeAllocation('I', 25000, [makeCoinPicker(2, 4, 1000, cp), makeCoinPicker(6, 4, 100, sp), makeCoinPicker(3, 6, 10, gp), makeCoinPicker(6, 6, 1, pp), plainString('lesser medium staff'), mult(2, plainString('lesser minor wondrous items')), plainString('greater medium potion'), plainString('lesser medium wand'), mult(2, gemPicker(2)), mult(2, gemPicker(3)), gemPicker(4)]),
	new TreasureTypeAllocation('I', 30000, [makeCoinPicker(2, 4, 1000, cp), makeCoinPicker(6, 4, 100, sp), makeCoinPicker(3, 6, 10, gp), makeCoinPicker(6, 6, 1, pp), plainString('lesser medium armor'), plainString('greater minor weapon'), plainString('lesser medium wondrous item'), mult(2, plainString('lesser major scrolls')), artPicker(4)]),
	new TreasureTypeAllocation('I', 40000, [makeCoinPicker(4, 4, 1000, cp), makeCoinPicker(6, 6, 100, sp), makeCoinPicker(2, 4, 100, gp), makeCoinPicker(6, 6, 1, pp), plainString('lesser medium weapon'), plainString('greater medium rod'), plainString('greater major potion'), plainString('greater medium scroll'), plainString('lesser medium wand'), mult(3, artPicker(3)), mult(2, artPicker(4))]),
	new TreasureTypeAllocation('I', 50000, [makeCoinPicker(4, 4, 10000, cp), makeCoinPicker(6, 6, 1000, sp), makeCoinPicker(4, 4, 100, gp), makeCoinPicker(2, 4, 10, pp), plainString('greater minor armor'), mult(2, plainString('greater minor weapons')), plainString('greater medium staff'), plainString('greater minor wondrous item'), gemPicker(5)]),
	new TreasureTypeAllocation('I', 60000, [makeCoinPicker(2, 4, 10000, cp), makeCoinPicker(2, 4, 1000, sp), makeCoinPicker(2, 4, 100, gp), makeCoinPicker(2, 4, 10, pp), plainString('greater medium weapon'), plainString('greater medium rod'), plainString('lesser medium wondrous item'), plainString('greater major scroll'), mult(2, plainString('greater minor wands')), gemPicker(4), mult(5, artPicker(2))]),
	new TreasureTypeAllocation('I', 75000, [makeCoinPicker(2, 4, 10000, cp), makeCoinPicker(2, 4, 1000, sp), makeCoinPicker(2, 4, 100, gp), makeCoinPicker(2, 4, 10, pp), plainString('lesser major armor'), plainString('greater medium ring'), plainString('lesser medium staff'), plainString('greater medium wand'), gemPicker(6), artPicker(4)]),
	new TreasureTypeAllocation('I', 100000, [makeCoinPicker(2, 4, 10000, cp), makeCoinPicker(2, 4, 1000, sp), makeCoinPicker(2, 4, 100, gp), makeCoinPicker(2, 4, 10, pp), plainString('lesser medium weapon'), plainString('greater medium ring'), plainString('lesser major rod'), plainString('greater medium wondrous item'), mult(2, plainString('greater major potions')), plainString('lesser medium scroll'), mult(2, artPicker(4))]),
	new TreasureTypeAllocation('I', 125000, [makeCoinPicker(4, 4, 10000, cp), makeCoinPicker(6, 6, 1000, sp), makeCoinPicker(4, 4, 100, gp), makeCoinPicker(2, 8, 10, pp), plainString('greater major armor'), plainString('lesser medium weapon'), plainString('lesser major staff'), mult(2, plainString('greater major scrolls')), plainString('greater major wand'), gemPicker(6), mult(3, artPicker(4))]),
	new TreasureTypeAllocation('I', 150000, [makeCoinPicker(4, 4, 10000, cp), makeCoinPicker(6, 6, 1000, sp), makeCoinPicker(4, 4, 100, gp), makeCoinPicker(2, 8, 10, pp), plainString('greater medium armor'), plainString('lesser major ring'), plainString('greater major wondrous item'), plainString('greater major wand')]),
	new TreasureTypeAllocation('I', 200000, [makeCoinPicker(4, 4, 10000, cp), makeCoinPicker(6, 6, 1000, sp), makeCoinPicker(4, 4, 100, gp), makeCoinPicker(2, 8, 10, pp), plainString('greater major weapon'), mult(2, plainString('lesser medium rings')), plainString('lesser major staff'), plainString('lesser major wondrous item'), plainString('lesser major wand'), mult(3, gemPicker(5)), gemPicker(4)]),
	new TreasureTypeAllocation('I', 300000, [makeCoinPicker(8, 4, 10000, cp), makeCoinPicker(12, 6, 1000, sp), makeCoinPicker(8, 4, 100, gp), makeCoinPicker(2, 8, 10, pp), plainString('greater major weapon'), plainString('lesser major ring'), plainString('greater major staff'), plainString('greater major wondrous item'), plainString('greater medium wand'), gemPicker(6), artPicker(6)])
	];
	
	// find the innermost enclosing node that has a "controller" object

	function controller(c) {
		while (c) {
			if (c.controller)
				return c.controller;
			c = c.parentNode;
		}
	}
</script>
<body onload="initAll()">
	<div id="summary"margin:1em; ></div>

	<div style="clear: both;"></div>

	<div id="total treasure value"margin:1em; >
		APL <select id="APL" onchange="recalcTotalTreasureBudget()">
			<option value="1" selected="on">1</option>
			<option value="2">2</option>
			<option value="3">3</option>
			<option value="4">4</option>
			<option value="5">5</option>
			<option value="6">6</option>
			<option value="7">7</option>
			<option value="8">8</option>
			<option value="9">9</option>
			<option value="10">10</option>
			<option value="11">11</option>
			<option value="12">12</option>
			<option value="13">13</option>
			<option value="14">14</option>
			<option value="15">15</option>
			<option value="16">16</option>
			<option value="17">17</option>
			<option value="18">18</option>
			<option value="19">19</option>
			<option value="20">20+</option>
		</select> Amount: <select id="APLMultiplier" onchange="recalcTotalTreasureBudget()">
			<option value="incidental">incidental</option>
			<option value="standard" selected="on">standard</option>
			<option value="double">double</option>
			<option value="triple">triple</option>
		</select> Advancement rate: <select id="AdvancementRate" onchange="recalcTotalTreasureBudget()">
			<option value="slow">slow</option>
			<option value="med" selected="on">medium</option>
			<option value="fast">fast</option>
		</select> Total treasure budget: <span class="money" id="totaltreasurebudget">0</span>

		<button onclick="recalcTotalTreasureBudget()">Reroll all</button>

		<button onclick="addNPCBlock()">Add NPC Block</button>
	</div>


	<div id="MAIN">
		<div id="SUMMARY">
			<div style="float: left; margin: 1em; padding: 1em;  border: thin solid black;">
				<table border="0" cellspacing="0" cellpadding="0">
					<tr>
						<TD></TD>
						<TH>Amt</TH>
						<TH>Value</TH>
					</tr>
					<tr>
						<TD>CP</TD>
						<TD id="cp_amt" class="money">0</TD>
						<TD id="cp_value" class="money">0.00</TD>
					</tr>
					<tr>
						<TD>SP</TD>
						<TD id="sp_amt" class="money">0</TD>
						<TD id="sp_value" class="money">0.00</TD>
					</tr>
					<tr>
						<TD>GP</TD>
						<TD id="gp_amt" class="money">0</TD>
						<TD id="gp_value" class="money">0.00</TD>
					</tr>
					<tr>
						<TD>PP</TD>
						<TD id="pp_amt" class="money">0</TD>
						<TD id="pp_value" class="money">0.00</TD>
					</tr>
					<tr>
						<TD>Subtotal</TD>
						<TD colspan="2" id="currency_value" class="money">0.00</TD>
					</tr>
					<tr>
						<TD>Gems</TD>
						<TD colspan="2" id="gem_value" class="money">0.00</TD>
					</tr>
					<tr>
						<TD>Art Objects</TD>
						<TD colspan="2" id="art_value" class="money">0.00</TD>
					</tr>
					<tr>
						<TD>Total</TD>
						<TD colspan="2" id="total_value" class="money" style="font-weight: bold;">0.00</TD>
					</tr>
				</table>
			</div>

			<div style="float: left;"">
				<div style="margin: 1em; padding: 1em; border: thin solid black;">
					<table border="0" cellspacing="0" cellpadding="0">
						<caption>Gems</caption>
						<tbody id="gem_table">
						</tbody>
					</table>
				</div>
				<div style="margin: 1em; padding: 1em; border: thin solid black;">
					<table border="0" cellspacing="0" cellpadding="0">
						<caption>Art Objects</caption>
						<tbody id="art_table">
						</tbody>
					</table>
				</div>
			</div>

			<div style="float: left; margin: 1em; padding: 1em; border: thin solid black;">
				<table border="0" cellspacing="0" cellpadding="0">
					<caption>Items</caption>
					<tbody id="item_table">
					</tbody>
				</table>
			</div>

			<div style="float: left;">
				<div style="margin: 1em; padding: 1em; border: thin solid black;">
					<table border="0" cellspacing="0" cellpadding="0">
						<caption>Weapons</caption>
						<tbody id="weapon_table">
						</tbody>
					</table>
				</div>

				<div style="margin: 1em; padding: 1em; border: thin solid black;">
					<table border="0" cellspacing="0" cellpadding="0">
						<caption>Armour</caption>
						<tbody id="armour_table">
						</tbody>
					</table>
				</div>
			</div>
		</div>
		<div style="clear: both;"></div>
		<div id="MAIN-TREASURE"></div>
		<div style="clear: both;"></div>
		<div id="NPC-TREASURES"></div>
	</div>

	<div style="clear: both;"></div>
	<hr>

	<font size="-1"> Paizo Publishing data used without permission. Using this generator without owning a paid-for copy of Ulimte Equipment is a chaotic act! Also, this generator won't be much use to you without one. <br>
		Javascript code &copy; <a href="mailto:Paul Murray<pmurray@bigpond.com">Paul Murray</a> 2014. <a href="http://paulmurray.wordpress.com">Wordpress</a>, <a href="https://twitter.com/#!/PaulMurrayCbr">Twitter</a>, <a
		href="http://www.facebook.com/PaulMurrayCbr">Facebook</a>.
	</font>
</body>
</html>